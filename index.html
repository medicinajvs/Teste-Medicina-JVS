<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
        }
        .font-exo2 { font-family: 'Exo 2', sans-serif; }
        .card { background-color: #1E1E1E; border: 1px solid #2D2D2D; }
        .progress-bar-bg { background-color: #2D2D2D; }
        .calendar-day { background-color: #2D3748; }
        .calendar-day-studied { background-color: #A96E5B; }
        .calendar-day-today { box-shadow: 0 0 0 2px #D98E73; }
        #subjectListContainer::-webkit-scrollbar, #map-panel-content::-webkit-scrollbar, #revisaoSubjectListContainer::-webkit-scrollbar { width: 8px; }
        #subjectListContainer::-webkit-scrollbar-track, #map-panel-content::-webkit-scrollbar-track, #revisaoSubjectListContainer::-webkit-scrollbar-track { background: #2D2D2D; }
        #subjectListContainer::-webkit-scrollbar-thumb, #map-panel-content::-webkit-scrollbar-thumb, #revisaoSubjectListContainer::-webkit-scrollbar-thumb { background-color: #5A5A5A; border-radius: 4px; }
        input[type="checkbox"]:indeterminate + div p { color: #FBBF24; }
        
        /* Estilos da Tela de Estudo de Flashcards */
        .study-view-grid { display: grid; grid-template-rows: auto 1fr; height: 100vh; }
        .flashcard-display-area { display: flex; flex-direction: column; align-items: center; padding-bottom: 1rem; }
        .study-card-background { background-color: #191C1F; transition: all 0.5s ease-in-out; }
        .flashcard-container { border: 3px solid transparent; border-radius: 0.5rem; transition: border-color 0.3s; }
        .study-rating-button {
            border: 2px solid #555; background-color: #2a2f35; transition: all 0.2s ease;
            width: 80px; height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 1rem; cursor: pointer;
        }
        .study-rating-button .rating-number { font-size: 1.5rem; font-weight: 700; }
        .study-rating-button .rating-text { font-size: 0.875rem; }

        .rating-1 { border-color: #a855f7; color: #a855f7; } /* Roxo */
        .rating-2 { border-color: #f97316; color: #f97316; } /* Laranja */
        .rating-3 { border-color: #eab308; color: #eab308; } /* Amarelo */
        .rating-4 { border-color: #22c55e; color: #22c55e; } /* Verde */
        
        .border-rating-1 { border-color: #a855f7 !important; }
        .border-rating-2 { border-color: #f97316 !important; }
        .border-rating-3 { border-color: #eab308 !important; }
        .border-rating-4 { border-color: #22c55e !important; }

        .study-nav-button .button-circle { background-color: white; }
        .study-nav-button .arrow-icon svg { color: #1f2937; }
        .study-progress-bar { background-color: #3E454D; }
        .study-progress-fill { background-color: #C48462; box-shadow: 0 0 10px #C4846280; }
        .study-header-bar { background-color: #212529; }
        .study-header-button { background-color: #191C1F; color: #727980; }
        .study-header-button:hover { background-color: #2a2f35; }
        .custom-card-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; }
        #flashcard-pair-container { display: flex; gap: 1rem; width: 100%; transition: all 0.5s ease-in-out; }

        .has-tooltip { position: relative; }
        .tooltip {
            visibility: hidden; opacity: 0; transition: opacity 0.2s, visibility 0.2s;
            position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%);
            background-color: #111; color: white; padding: 5px 10px; border-radius: 6px;
            font-size: 0.75rem; white-space: nowrap; z-index: 10;
        }
        .has-tooltip:hover .tooltip { visibility: visible; opacity: 1; }

        #map-panel { transition: transform 0.3s ease-in-out; }
        #map-overlay { transition: opacity 0.3s ease-in-out; }

        /* Estilos para o modal de filtros */
        .subject-item {
            padding: 0.25rem 0;
        }
        .difficulty-btn {
            background-color: #2D2D2D;
            border: 1px solid #4A4A4A;
        }
        .difficulty-btn.active {
            background-color: #D98E73;
            color: #121212;
            border-color: #D98E73;
        }
        .stats-toggle {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }
        .stats-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .stats-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4A4A4A;
            transition: .4s;
            border-radius: 24px;
        }
        .stats-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .stats-slider {
            background-color: #22c55e; /* Verde */
        }
        input:checked + .stats-slider:before {
            transform: translateX(16px);
        }
        .detailed-stats {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            margin-top: 0.5rem;
        }
        /* Estilo para o seletor de data */
        .custom-select-wrapper {
            position: relative;
            display: inline-block;
        }
        .custom-select-wrapper select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 2rem; /* Espaço para a seta */
        }
        .custom-select-wrapper .arrow-down {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        /* Remove a linha de borda dos filtros */
        .subject-children {
            border-left: none !important;
        }
        /* Estilos do Menu Lateral */
        #mainMenuPanel {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        #mainMenuPanel.open {
            transform: translateX(0);
        }

    </style>
    <script>
        function handleImageError(image) {
            const failedSrc = image.getAttribute('src');
            if (!failedSrc || failedSrc.startsWith('https://placehold.co')) {
                image.onerror = null; return;
            }
            console.error(`[ERRO] Não foi possível carregar a imagem no caminho: ${failedSrc}`);
            const displayPath = failedSrc.split('/').slice(-3).join('/');
            image.src = `https://placehold.co/1080x1450/1E1E1E/ff0000?text=ERRO%0A${encodeURIComponent(displayPath)}`;
            image.onerror = null;
        }
    </script>
</head>
<body class="text-gray-300">

    <!-- Cabeçalho Full-width -->
    <header class="w-full bg-[#121212] border-b border-[#2D2D2D]">
        <div class="container mx-auto flex justify-between items-center relative h-16 px-4 sm:px-6 lg:px-8">
            <div class="flex items-center gap-4">
                <button id="mainMenuBtn" class="text-gray-400 hover:text-white z-30 p-2">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h1 class="text-2xl font-bold text-white">Flashcards</h1>
            </div>
            <div class="flex items-center gap-2">
                 <div id="searchContainer" class="flex items-center justify-end">
                    <button id="searchBtn" class="w-10 h-10 flex items-center justify-center rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-all duration-300 z-10">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                    <div id="searchInputWrapper" class="relative w-0 transition-all duration-300 ease-in-out">
                        <input id="searchInput" type="text" placeholder="Pesquisar aulas ou seções..." class="w-full bg-[#2D2D2D] text-white rounded-lg pl-4 pr-10 py-2 focus:outline-none opacity-0 transition-opacity duration-300">
                        <button id="closeSearchBtn" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white opacity-0 transition-opacity duration-300">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                        <!-- Dropdown de Resultados da Busca -->
                        <div id="searchResults" class="hidden absolute top-full left-0 w-full mt-2 bg-[#1E1E1E] border border-[#2D2D2D] rounded-lg shadow-lg z-20 overflow-hidden max-h-80 overflow-y-auto">
                            <!-- Resultados populados via JS -->
                        </div>
                    </div>
                </div>
                <div class="relative flex items-center">
                    <button id="notificationsBtn" class="w-10 h-10 flex items-center justify-center rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-colors">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                    </button>
                    <!-- Dropdown Notificações -->
                    <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-80 bg-gray-800/80 backdrop-blur-sm rounded-lg shadow-lg z-10 p-4">
                        <div class="flex justify-between items-center mb-2">
                             <h3 class="font-semibold">Notificações</h3>
                             <button id="closeNotificationsBtn" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
                        </div>
                        <p class="text-sm text-gray-500 text-center">Nenhuma notificação encontrada.</p>
                    </div>
                </div>
                <div class="relative flex items-center">
                    <button id="userMenuBtn" class="flex items-center gap-2 text-white p-1 rounded-full hover:bg-white/10 transition-colors">
                        <img src="https://placehold.co/32x32/D98E73/FFFFFF?text=M" alt="Avatar" class="w-8 h-8 rounded-full">
                        <span class="text-sm font-medium hidden md:inline pr-2">Mar</span>
                        <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400 hidden md:inline mr-2"></i>
                    </button>
                    <!-- Dropdown Usuário -->
                    <div id="userMenuDropdown" class="hidden absolute right-0 top-full mt-2 w-56 bg-white rounded-lg shadow-2xl z-10 text-gray-900">
                        <div class="p-2">
                            <div class="px-2 py-2">
                                <p class="text-sm text-gray-500">rodricarva64</p>
                            </div>
                            <hr class="border-gray-200">
                            <div class="mt-2 space-y-1">
                                <a href="#" class="block px-2 py-1.5 text-sm font-semibold hover:bg-gray-100 rounded-md">Meu Perfil</a>
                                <a href="#" class="block px-2 py-1.5 text-sm font-semibold hover:bg-gray-100 rounded-md">Meus Acessos</a>
                                <a href="#" class="block px-2 py-1.5 text-sm font-semibold hover:bg-gray-100 rounded-md">Suporte no WhatsApp</a>
                            </div>
                            <hr class="my-2 border-gray-200">
                            <div>
                                <span class="block px-2 pt-1 pb-2 text-xs font-semibold text-gray-400">Meus Ambientes</span>
                                <a href="#" class="block px-2 py-1.5 text-sm text-gray-500 hover:bg-gray-100 rounded-md">MED-REVIEW</a>
                            </div>
                            <hr class="my-2 border-gray-200">
                            <div>
                                <a href="#" class="block px-2 py-1.5 text-sm font-semibold hover:bg-gray-100 rounded-md">Sair</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
     <!-- Menu Lateral Principal -->
    <div id="mainMenuOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-20"></div>
    <div id="mainMenuPanel" class="fixed top-0 left-0 h-full w-64 bg-[#1E1E1E] p-6 z-30">
        <button id="closeMainMenuBtn" class="absolute top-6 left-6 text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
        <nav class="flex flex-col space-y-2 mt-20">
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-gray-300">
                <i data-lucide="home" class="w-5 h-5"></i><span>Home</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-gray-300">
                <i data-lucide="play-circle" class="w-5 h-5"></i><span>Cursos</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-gray-300">
                <i data-lucide="file-text" class="w-5 h-5"></i><span>Banco de Questões 2.0</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg bg-[#D98E73] text-black font-semibold">
                <i data-lucide="copy" class="w-5 h-5"></i>
                <span>Flashcards 2.0</span>
                <span class="ml-auto text-xs bg-white/30 text-white px-2 py-0.5 rounded-full">BETA</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-gray-300">
                <i data-lucide="phone" class="w-5 h-5"></i><span>Suporte</span>
            </a>
            <a href="#" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10 text-gray-300">
                <i data-lucide="log-out" class="w-5 h-5"></i><span>Sair</span>
            </a>
        </nav>
    </div>

    <div id="dashboardView" class="container mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-4 sm:pb-6 lg:pb-8">
        <main class="grid grid-cols-1">
            <div class="flex items-center gap-4 mb-8">
                <button id="openLearningModeBtn" class="bg-[#2D2D2D] border border-gray-700 rounded-lg px-4 py-2 flex items-center gap-2 text-sm">
                    <span>Modo de estudo: Treino Livre</span>
                </button>
                <button id="openFiltersBtn" class="bg-[#2D2D2D] border border-gray-700 rounded-lg px-4 py-2 flex items-center gap-2 text-sm">
                    <i data-lucide="filter" class="w-4 h-4"></i>
                    <span>Filtro de Assuntos</span>
                </button>
            </div>

            <!-- View de Treino Livre -->
            <div id="treinoLivreView" class="flex flex-col gap-12">
                <!-- Cards Revisados -->
                <div id="cardsRevisadosTreino" class="card p-6 rounded-lg">
                    <h2 class="text-lg font-bold text-white tracking-wide">TREINO LIVRE</h2>
                    <p class="text-sm text-gray-400 mb-6">Métricas baseadas nos filtros selecionados atualmente.</p>
                    
                    <div class="flex justify-between items-center my-2">
                        <p id="treinoLivreReviewedCount" class="text-sm text-gray-400">0 de 0 Cards com filtros aplicados</p>
                        <span id="treinoLivreReviewedPercent" class="text-sm text-gray-400 font-bold">0%</span>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-2.5 mb-2 overflow-hidden flex">
                        <div id="treinoLivreBarErrei" class="bg-purple-500 h-2.5" style="width: 0%"></div>
                        <div id="treinoLivreBarDificil" class="bg-orange-500 h-2.5" style="width: 0%"></div>
                        <div id="treinoLivreBarModerado" class="bg-yellow-500 h-2.5" style="width: 0%"></div>
                        <div id="treinoLivreBarFacil" class="bg-green-500 h-2.5" style="width: 0%"></div>
                    </div>
                    <div class="flex items-center gap-4 text-xs text-gray-400 mt-3">
                        <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-sm bg-purple-500"></span>Errei (<span id="treinoLivreCountErrei">0</span>)</span>
                        <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-sm bg-orange-500"></span>Difícil (<span id="treinoLivreCountDificil">0</span>)</span>
                        <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-sm bg-yellow-500"></span>Moderado (<span id="treinoLivreCountModerado">0</span>)</span>
                        <span class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 rounded-sm bg-green-500"></span>Fácil (<span id="treinoLivreCountFacil">0</span>)</span>
                    </div>
                    <button id="startStudyBtn" class="w-full bg-[#D98E73] hover:bg-[#c87e63] text-black font-bold py-3 rounded-lg mt-8 text-base">
                        Iniciar Treino Livre (0)
                    </button>
                </div>
            </div>

            <!-- View de Revisão Espaçada -->
            <div id="revisaoEspacadaView" class="hidden flex flex-col gap-12">
                 <div class="flex flex-col items-center justify-center gap-8 py-12">
                    <h2 class="text-sm font-semibold text-gray-400 tracking-wider">CARDS PARA HOJE</h2>
                    <div class="relative w-48 h-48">
                        <canvas id="todayProgressChart"></canvas>
                        <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                            <span id="todayProgressPercent" class="text-4xl font-bold text-white">0%</span>
                            <span class="text-sm text-gray-400">Progresso Hoje</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-12 text-center w-full max-w-3xl">
                        <div class="flex flex-col items-center gap-2 p-4 rounded-lg bg-[#1E1E1E]">
                            <i data-lucide="layers" class="w-10 h-10 text-gray-400"></i>
                            <p id="todayCardsCount" class="text-lg font-semibold text-white mt-2">0/0</p>
                            <p class="text-sm text-gray-400">Revisar hoje</p>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-4 rounded-lg bg-[#1E1E1E]">
                            <i data-lucide="timer" class="w-10 h-10 text-gray-400"></i>
                            <p id="todayTime" class="text-lg font-semibold text-white mt-2">00:00:00</p>
                            <p class="text-sm text-gray-400">Tempo estudado</p>
                        </div>
                        <div class="flex flex-col items-center gap-2 p-4 rounded-lg bg-[#1E1E1E]">
                            <i data-lucide="flame" class="w-10 h-10 text-gray-400"></i>
                            <p id="todayStreak" class="text-lg font-semibold text-white mt-2">0d</p>
                            <p class="text-sm text-gray-400">Sequência</p>
                        </div>
                    </div>
                    <button id="startReviewBtn" class="w-full max-w-lg bg-[#D98E73] hover:bg-[#c87e63] text-black font-bold py-4 px-8 rounded-lg text-lg">
                        Revisar agora (0)
                    </button>
                </div>
            </div>

            <!-- Container de Métricas Compartilhadas (VISIBILIDADE CONTROLADA PELO MODO ATIVO) -->
            <div id="sharedMetricsContainer" class="flex flex-col gap-12 mt-12">
                 <!-- Métricas dos Flashcards -->
                 <div id="metricasSection">
                    <h2 class="text-2xl font-semibold text-white mb-4">MÉTRICAS DOS FLASHCARDS</h2>
                    <div class="card p-6 rounded-lg">
                        <div class="flex flex-col md:flex-row items-center gap-6 md:gap-10">
                            <div class="flex flex-row md:flex-col gap-4">
                                <div class="bg-gray-800 p-4 rounded-lg text-center border border-gray-700 w-36">
                                    <p id="avgCardsDay" class="text-3xl font-bold text-white">0</p>
                                    <p class="text-xs text-gray-400">Média cards/dia</p>
                                </div>
                                <div class="bg-gray-800 p-4 rounded-lg text-center border border-gray-700 w-36">
                                    <p id="totalReviewed" class="text-3xl font-bold text-white">0</p>
                                    <p class="text-xs text-gray-400">Total revisados</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-6 flex-1">
                                <div id="metricas-imagem-container" class="w-40 h-40 flex-shrink-0">
                                    <!-- A imagem de placeholder pode ser substituída por um ícone SVG ou imagem de um card -->
                                    <img id="metricas-imagem-placeholder" src="https://placehold.co/200x200/1E1E1E/3E454D?text=Imagem" alt="Métricas Imagem" class="w-full h-full object-contain" onerror="handleImageError(this)">
                                </div>
                                <div class="flex-1">
                                    <p class="text-base font-medium text-white flex items-center gap-2">Cards dominados 
                                        <!-- Placeholder para ícone -->
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#D9534F" class="text-red-500"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                                    </p>
                                    <p id="dominatedCardsText" class="text-xs text-gray-400 mt-1 mb-8">0/0 cards do total</p>
                                    <div class="relative w-full mt-4">
                                        <div class="w-full progress-bar-bg rounded-full h-2 relative">
                                            <div id="dominatedCardsBar" class="bg-yellow-500 h-2 rounded-full" style="width: 0%;"></div>
                                            <!-- Atenção: O left deve ser ajustado dinamicamente para manter o texto alinhado com a barra -->
                                            <div id="dominatedCardsPercent" class="absolute top-[-25px] text-xs text-white font-bold" style="left: 0%; transform: translateX(-50%);">0%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Cards Estudados -->
                <div id="studiedCardsSection" class="card p-6 rounded-lg">
                    <h2 class="text-2xl font-semibold text-white mb-2">CARDS ESTUDADOS</h2>
                    <p class="text-sm text-gray-400 mb-6">Cards revisados por marcação</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="relative w-48 h-48 mx-auto">
                            <canvas id="studiedCardsChart"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <span class="text-sm text-gray-400">Total</span>
                                <span id="studiedCardsTotal" class="text-3xl font-bold text-white">0</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <!-- Cabeçalho da Tabela -->
                            <div class="grid grid-cols-3 items-center text-sm font-semibold text-gray-400 px-2">
                                <span class="text-left">Dificuldade</span>
                                <span class="text-center">Quantidade</span>
                                <span class="text-right">Porcentagem</span>
                            </div>
                            <!-- Linhas de Dados -->
                            <div class="grid grid-cols-3 items-center text-sm p-2">
                                <span class="flex items-center gap-2 text-left"><div class="w-3 h-3 rounded-full bg-green-500"></div>Fácil</span>
                                <span id="stats-facil-qnt" class="text-white font-medium text-center">0</span>
                                <span id="stats-facil-pct" class="text-gray-400 text-right">0%</span>
                            </div>
                            <div class="grid grid-cols-3 items-center text-sm p-2">
                                <span class="flex items-center gap-2 text-left"><div class="w-3 h-3 rounded-full bg-yellow-500"></div>Moderado</span>
                                <span id="stats-medio-qnt" class="text-white font-medium text-center">0</span>
                                <span id="stats-medio-pct" class="text-gray-400 text-right">0%</span>
                            </div>
                            <div class="grid grid-cols-3 items-center text-sm p-2">
                                <span class="flex items-center gap-2 text-left"><div class="w-3 h-3 rounded-full" style="background-color: #f97316"></div>Difícil</span>
                                <span id="stats-dificil-qnt" class="text-white font-medium text-center">0</span>
                                <span id="stats-dificil-pct" class="text-gray-400 text-right">0%</span>
                            </div>
                            <div class="grid grid-cols-3 items-center text-sm p-2">
                                <span class="flex items-center gap-2 text-left"><div class="w-3 h-3 rounded-full bg-purple-600"></div>Errei</span>
                                <span id="stats-errei-qnt" class="text-white font-medium text-center">0</span>
                                <span id="stats-errei-pct" class="text-gray-400 text-right">0%</span>
                            </div>
                            <hr class="border-gray-700 my-2">
                            <div class="grid grid-cols-3 items-center text-sm font-bold p-2">
                                <span class="text-white text-left">Total</span>
                                <span></span>
                                <span id="stats-total-qnt" class="text-white text-right">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                 <!-- Evolução -->
                <div id="evolutionSection" class="card p-6 rounded-lg">
                    <h2 class="text-2xl font-semibold text-white mb-1">EVOLUÇÃO</h2>
                    <p class="text-sm text-gray-400 mb-4">Período: 6 meses</p>
                    <div class="flex items-center gap-6 text-sm mb-4">
                        <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-green-500"></div>Fácil</span>
                        <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-yellow-500"></div>Moderado</span>
                        <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full" style="background-color: #f97316"></div>Difícil</span>
                        <span class="flex items-center gap-2"><div class="w-3 h-3 rounded-full bg-purple-600"></div>Errei</span>
                    </div>
                    <div class="h-80">
                         <canvas id="evolutionChart"></canvas>
                    </div>
                </div>
                <!-- Calendário de Estudos -->
                <div id="calendarSection" class="card p-6 rounded-lg">
                    <h2 class="text-2xl font-semibold text-white">CALENDÁRIO DE ESTUDOS</h2>
                    <div class="flex justify-between items-center my-4">
                        <span id="calendar-title" class="font-semibold text-white text-lg"></span>
                        <div class="flex items-center gap-2">
                            <div class="custom-select-wrapper">
                                <select id="calendar-month-year-select" class="bg-[#2D2D2D] border border-gray-600 rounded-md px-3 py-1.5 text-sm text-white focus:outline-none"></select>
                                <div class="arrow-down">
                                    <i data-lucide="chevron-down" class="w-4 h-4 text-gray-400"></i>
                                </div>
                            </div>
                            <button id="calendar-prev" class="bg-[#2D2D2D] border border-gray-600 rounded-md p-2"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                            <button id="calendar-next" class="bg-[#2D2D2D] border border-gray-600 rounded-md p-2"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <div id="calendar" class="grid grid-cols-[auto,repeat(7,1fr)] gap-2 text-center text-sm">
                         <!-- Conteúdo gerado pelo JS -->
                    </div>
                </div>
            </div>
        </main>
        <footer class="bg-[#121212] text-center py-6 mt-12 border-t border-[#2D2D2D]">
            <p class="text-sm text-gray-600">&copy; 2025 Medicina JVS. Todos os direitos reservados.</p>
        </footer>
    </div>
    
    <!-- View de Estudo de Flashcards -->
    <div id="studyView" class="hidden min-h-screen bg-gray-900 text-white font-exo2 study-view-grid">
        <div class="study-header-bar py-2 px-4 z-50">
            <div class="flex items-center gap-2 justify-between w-full relative">
                <div class="flex items-center justify-start gap-2 min-w-0 flex-1 overflow-hidden">
                    <button id="backToDashboardBtn" class="study-header-button flex gap-2 items-center px-4 py-2 me-4 rounded-lg font-semibold text-sm transition flex-shrink-0">
                        <i data-lucide="arrow-left" class="h-4 w-4"></i>
                        <span class="hidden md:inline">Voltar</span>
                    </button>
                    <div class="flex flex-col md:flex-row md:items-center md:gap-2">
                        <h2 id="studyModeTitle" class="text-lg font-semibold whitespace-nowrap text-ellipsis overflow-hidden max-w-full">Estudando</h2>
                    </div>
                </div>
                <div class="flex gap-4 items-center justify-end whitespace-nowrap min-w-0 flex-shrink-0">
                    <button id="instructionsBtn" class="study-header-button flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition">
                        <i data-lucide="help-circle" class="w-4 h-4"></i>
                        <span class="hidden md:inline">Instruções de Uso</span>
                    </button>
                    <button id="mapBtn" class="study-header-button flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition">
                        <i data-lucide="map" class="w-4 h-4"></i>
                        <span class="hidden md:inline">Mapa de flashcards</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="cards-container flex items-start justify-center gap-4 px-4 relative overflow-auto pt-8">
            <button id="prev-card-btn" class="study-nav-button group relative nav-left self-center">
                <div class="button-circle w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 group-hover:scale-110 group-hover:shadow-xl">
                    <div class="arrow-icon"><i data-lucide="chevron-left" class="w-6 h-6 text-gray-800 transition-transform duration-200 group-hover:-translate-x-1"></i></div>
                </div>
            </button>
            <div class="flashcard-display-area w-full">
                <div class="progress-section mb-4 w-full max-w-4xl">
                    <h1 class="text-lg font-semibold text-white mb-2">Cards</h1>
                    <div class="flex items-center gap-4">
                        <div id="study-progress-text" class="text-sm font-medium text-gray-300 flex-shrink-0">0/0</div>
                        <div class="w-full study-progress-bar rounded-full h-2.5">
                            <div id="study-progress-fill" class="study-progress-fill h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%;"></div>
                        </div>
                    </div>
                </div>
                <div id="card-area" class="study-card-background w-full rounded-lg flex items-center justify-center p-2 transition-all duration-500 ease-in-out">
                    <div id="flashcard-pair-container">
                        <div id="flashcard-front-container" class="flashcard-container flex-1 aspect-[500/672] relative">
                            <!-- front-bg-img e front-fg-img são preenchidos via JS -->
                            <img id="flashcard-front-bg-img" src="" alt="Fundo do Flashcard" class="custom-card-image" onerror="handleImageError(this)">
                            <img id="flashcard-front-fg-img" src="https://placehold.co/1080x1450/191C1F/3E454D?text=Selecione+os+filtros" alt="Frente do Flashcard" class="custom-card-image" onerror="handleImageError(this)">
                        </div>
                        <div id="flashcard-back-container" class="flashcard-container hidden flex-1 aspect-[500/672] relative">
                             <!-- back-bg-img e back-fg-img são preenchidos via JS -->
                             <img id="flashcard-back-bg-img" src="" alt="Fundo da Resposta" class="custom-card-image" onerror="handleImageError(this)">
                            <img id="flashcard-back-fg-img" src="" alt="Verso do Flashcard" class="custom-card-image" onerror="handleImageError(this)">
                        </div>
                    </div>
                </div>
                <div class="action-container mt-4">
                    <div id="reveal-section" class="flex items-center justify-center relative w-full"><button id="reveal-button" class="bg-[#D98E73] hover:bg-[#c87e63] text-black font-bold py-3 rounded-lg text-base px-8"> Revelar resposta </button></div>
                    <div id="rating-section" class="hidden text-center">
                        <p class="mb-4 font-semibold">O quanto você sabia deste card?</p>
                        <div class="flex items-center justify-center gap-4">
                            <button data-rating="1" class="study-rating-button rating-1"><span class="rating-number">1</span><span class="rating-text">Errei</span></button>
                            <button data-rating="2" class="study-rating-button rating-2"><span class="rating-number">2</span><span class="rating-text">Difícil</span></button>
                            <button data-rating="3" class="study-rating-button rating-3"><span class="rating-number">3</span><span class="rating-text">Médio</span></button>
                            <button data-rating-keyboard="3" data-rating="4" class="study-rating-button rating-4"><span class="rating-number">4</span><span class="rating-text">Fácil</span></button>
                        </div>
                         <p class="text-xs text-gray-500 mt-4">Use as teclas 1, 2, 3 e 4 para avaliar rapidamente</p>
                    </div>
                </div>
            </div>
            <button id="next-card-btn" class="study-nav-button group relative nav-right self-center">
                <div class="button-circle w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 group-hover:scale-110 group-hover:shadow-xl">
                    <div class="arrow-icon"><i data-lucide="chevron-right" class="w-6 h-6 text-gray-800 transition-transform duration-200 group-hover:translate-x-1"></i></div>
                </div>
            </button>
        </div>
    </div>


    <!-- Modal Instruções de Uso -->
    <div id="instructionsModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-[60] hidden">
        <div class="bg-[#1E1E1E] border border-[#2D2D2D] rounded-2xl p-8 w-full max-w-lg relative text-white font-sans">
            <button id="closeInstructionsBtn" class="absolute top-6 right-6 text-gray-400 hover:text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-xl font-bold mb-2 text-center">TUTORIAL</h2>
            <hr class="border-gray-700 mb-6">
            <h3 class="font-semibold text-lg mb-4">O que é Revisão Espaçada?</h3>
            <p class="text-gray-400 text-sm mb-6">A cada flashcard, você avalia o quanto você sabe daquele assunto.</p>
            
            <div class="space-y-4 mb-6">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-12 h-12 flex flex-col items-center justify-center rounded-lg border-2 border-purple-500 text-purple-500">
                        <span class="font-bold text-xl">1</span>
                        <span class="text-xs">Errei</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white">Errei</h4>
                        <p class="text-gray-400 text-sm">Desconhecia a resposta e tema.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-12 h-12 flex flex-col items-center justify-center rounded-lg border-2 border-orange-500 text-orange-500">
                        <span class="font-bold text-xl">2</span>
                        <span class="text-xs">Difícil</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white">Difícil</h4>
                        <p class="text-gray-400 text-sm">Conhecia o tema, mas errei.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-12 h-12 flex flex-col items-center justify-center rounded-lg border-2 border-yellow-500 text-yellow-500">
                        <span class="font-bold text-xl">3</span>
                        <span class="text-xs">Médio</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white">Médio</h4>
                        <p class="text-gray-400 text-sm">Acertei o tema, porém com dificuldade.</p>
                    </div>
                </div>
                 <div class="flex items-start gap-4">
                    <div class="flex-shrink-0 w-12 h-12 flex flex-col items-center justify-center rounded-lg border-2 border-green-500 text-green-500">
                        <span class="font-bold text-xl">4</span>
                        <span class="text-xs">Fácil</span>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white">Fácil</h4>
                        <p class="text-gray-400 text-sm">Acertei de imediato.</p>
                    </div>
                </div>
            </div>

            <p class="text-gray-400 text-sm mb-6">Essa avaliação nos ajuda a programar quando você vai revisar esse conteúdo de novo, no momento ideal pra fixar de verdade! 🧠✨</p>

            <h3 class="font-semibold text-lg mb-4">Comandos de Teclado</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center gap-2">
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">Espaço</kbd>
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">Enter</kbd>
                    </div>
                    <span>Mostra a resposta do flashcard</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center gap-2">
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">←</kbd>
                         <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">→</kbd>
                    </div>
                    <span>Voltar ou avançar no deck</span>
                </div>
                 <div class="flex items-center justify-between text-sm">
                    <div class="flex items-center gap-2">
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">1</kbd>
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">2</kbd>
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">3</kbd>
                        <kbd class="px-2 py-1.5 text-xs font-semibold text-gray-300 bg-gray-700 border border-gray-600 rounded-lg">4</kbd>
                    </div>
                    <span>Errei, Difícil, Médio, Fácil</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Painel Lateral Mapa de Flashcards -->
    <div id="map-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden"></div>
    <div id="map-panel" class="fixed top-0 right-0 h-full w-full max-w-md bg-[#1E1E1E] border-l border-[#2D2D2D] z-[70] transform translate-x-full">
        <div class="flex flex-col h-full">
            <div class="p-4 border-b border-[#2D2D2D] flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Mapa de Flashcards</h2>
                <button id="closeMapBtn" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div id="map-panel-content" class="flex-grow p-4 overflow-y-auto space-y-2">
                <!-- Conteúdo do mapa gerado dinamicamente -->
            </div>
            <div class="p-4 border-t border-[#2D2D2D] flex justify-between items-center flex-shrink-0">
                <button id="map-prev-btn" class="bg-[#2D2D2D] p-2 rounded-md disabled:opacity-50"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                <span id="map-page-indicator" class="text-sm">Página 1 de 1</span>
                <button id="map-next-btn" class="bg-[#2D2D2D] p-2 rounded-md disabled:opacity-50"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
            </div>
        </div>
    </div>


    <!-- Modais de Seleção e Filtros -->
    <div id="learningModeModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-[#1E1E1E] border border-[#2D2D2D] rounded-2xl p-8 w-full max-w-lg relative text-white">
            <button id="closeLearningModeBtn" class="absolute top-6 right-6 text-gray-400 hover:text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h2 class="text-2xl font-bold mb-8">Modo de aprendizado</h2>
            <div class="space-y-4">
                <!-- Estilo de seleção unificado -->
                <div id="selectRevisaoEspacada" class="border border-gray-700 rounded-xl p-6 flex gap-6 items-start cursor-pointer">
                    <div class="bg-[#D98E73] bg-opacity-20 text-[#D98E73] rounded-lg p-3">
                        <i data-lucide="rotate-cw" class="w-6 h-6"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-lg">Revisão espaçada</h3>
                            <div class="selection-indicator w-6 h-6 rounded-full border-2 border-gray-500 flex items-center justify-center"></div>
                        </div>
                        <p class="text-gray-400 mt-2 text-sm leading-relaxed">
                            A IA Lux escolhe os flashcards certos para você revisar no momento ideal. Ideal para memorizar de verdade e vencer a curva do esquecimento.
                        </p>
                    </div>
                </div>
                <div id="selectTreinoLivre" class="border border-gray-700 rounded-xl p-6 flex gap-6 items-start cursor-pointer">
                    <div class="bg-[#D98E73] bg-opacity-20 text-[#D98E73] rounded-lg p-3">
                        <i data-lucide="zap" class="w-6 h-6"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-lg">Treino livre</h3>
                            <div class="selection-indicator w-6 h-6 rounded-full border-2 border-gray-500 flex items-center justify-center"></div>
                        </div>
                        <p class="text-gray-400 mt-2 text-sm leading-relaxed">
                            Você escolhe os temas que quer revisar, no seu ritmo. Ótimo para explorar conteúdos ou reforçar pontos específicos.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Filtros (Treino Livre) -->
     <div id="filtersModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-[#1E1E1E] border border-[#2D2D2D] rounded-2xl flex flex-col w-full max-w-4xl h-[90vh] text-white">
            <!-- Cabeçalho -->
            <div class="p-4 border-b border-[#2D2D2D] flex justify-between items-center">
                 <h2 class="text-xl font-bold">Filtros de assuntos</h2>
                 <button id="closeFiltersModalBtn" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>

            <!-- Corpo Principal -->
            <div class="flex-grow p-4 space-y-4 overflow-hidden flex flex-col">
                <div class="flex justify-between items-center">
                    <p class="text-sm font-semibold">Ver estatísticas</p>
                    <div class="flex items-center gap-4">
                        <button id="selectAllBtn" class="text-sm bg-[#2D2D2D] hover:bg-gray-600 px-3 py-1 rounded-md">Selecionar todos</button>
                        <button id="unselectAllBtn" class="text-sm bg-[#2D2D2D] hover:bg-gray-600 px-3 py-1 rounded-md">Desmarcar todos</button>
                        <label class="stats-toggle">
                            <input type="checkbox" id="statsToggle">
                            <span class="stats-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="relative">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    <input id="filterSearchInput" type="text" placeholder="Buscar assuntos..." class="w-full bg-[#121212] border border-[#2D2D2D] rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-[#D98E73]">
                </div>
                
                <!-- Lista de Assuntos -->
                <div id="subjectListContainer" class="flex-grow overflow-y-auto pr-2">
                    <!-- Conteúdo gerado dinamicamente -->
                </div>
            </div>

            <!-- Rodapé -->
            <div class="p-4 border-t border-[#2D2D2D] space-y-4">
                 <div class="grid grid-cols-2 gap-8">
                     <div>
                         <h4 class="font-semibold mb-2 text-sm">Excluir</h4>
                         <div class="flex flex-col gap-2">
                            <label class="flex items-center gap-2 text-sm text-gray-300 cursor-pointer">
                                <input type="checkbox" id="excludeVistos" class="w-4 h-4 bg-gray-700 border-gray-600 rounded">
                                Vistos
                            </label>
                             <label class="flex items-center gap-2 text-sm text-gray-300 cursor-pointer">
                                <input type="checkbox" id="excludeDominados" class="w-4 h-4 bg-gray-700 border-gray-600 rounded">
                                Dominados
                            </label>
                         </div>
                     </div>
                     <div>
                        <h4 class="font-semibold mb-2 text-sm">Dificuldade</h4>
                        <div id="difficultyFilters" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 gap-2 text-sm">
                            <button data-difficulty="1" class="difficulty-btn p-2 rounded-md flex items-center justify-center gap-1.5"><div class="w-2 h-2 rounded-full bg-purple-500"></div>Errei</button>
                            <button data-difficulty="2" class="difficulty-btn p-2 rounded-md flex items-center justify-center gap-1.5"><div class="w-2 h-2 rounded-full bg-orange-500"></div>Difícil</button>
                            <button data-difficulty="3" class="difficulty-btn p-2 rounded-md flex items-center justify-center gap-1.5"><div class="w-2 h-2 rounded-full bg-yellow-500"></div>Moderado</button>
                            <button data-difficulty="4" class="difficulty-btn p-2 rounded-md flex items-center justify-center gap-1.5"><div class="w-2 h-2 rounded-full bg-green-500"></div>Fácil</button>
                            <button data-difficulty="all" class="difficulty-btn col-span-full md:col-span-2 lg:col-span-4 rounded-md py-2 text-center active">Todos</button>
                        </div>
                     </div>
                 </div>
                 <div class="flex justify-between items-center pt-2">
                     <button id="resetFiltersBtn" class="text-sm text-gray-400 hover:text-white">Redefinir filtros</button>
                     <button id="applyFiltersBtn" class="bg-[#D98E73] hover:bg-[#c87e63] text-black font-bold py-2.5 px-6 rounded-lg text-sm">
                        Aplicar filtros (0 flashcards)
                    </button>
                 </div>
            </div>
        </div>
    </div>

    <!-- Modal de Filtros para Revisão Espaçada -->
    <div id="revisaoFiltersModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-[#1E1E1E] border border-[#2D2D2D] rounded-2xl flex flex-col w-full max-w-2xl h-[70vh] text-white">
            <div class="p-4 border-b border-[#2D2D2D] flex justify-between items-center">
                 <h2 class="text-xl font-bold">Filtrar flashcards</h2>
                 <button id="closeRevisaoFiltersModalBtn" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            <div class="flex-grow p-4 space-y-4 overflow-hidden flex flex-col">
                <div class="relative">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
                    <input id="revisaoFilterSearchInput" type="text" placeholder="Buscar assuntos..." class="w-full bg-[#121212] border border-[#2D2D2D] rounded-lg pl-10 pr-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-[#D98E73]">
                </div>
                <div id="revisaoSubjectListContainer" class="flex-grow overflow-y-auto pr-2 space-y-2">
                    <!-- Conteúdo dinâmico para filtros de revisão -->
                </div>
            </div>
            <div class="p-4 border-t border-[#2D2D2D] flex justify-between items-center">
                <button id="resetRevisaoFiltersBtn" class="text-sm text-gray-400 hover:text-white">Redefinir</button>
                <button id="applyRevisaoFiltersBtn" class="bg-[#D98E73] hover:bg-[#c87e63] text-black font-bold py-2.5 px-6 rounded-lg text-sm">
                   Aplicar filtros (0 flashcards)
               </button>
            </div>
        </div>
    </div>


    <script>
        
        // --- Estrutura de Assuntos e Decks Simulados ---
        const subjectsData = [
            { name: 'CIRURGIA GERAL', children: [
                { name: 'Trauma', children: ['Avaliação Inicial', 'Via Aérea e Ventilação', 'Choque Hemorrágico', 'Trauma Torácico', 'Trauma Abdominal e Pélvico', 'Trauma Raquimedular', 'Trauma Cranioencefálico', 'Trauma Musculoesquelético', 'Trauma em Populações Especiais', 'Queimaduras e Trauma Elétrico', 'Trauma Cervical'] },
                { name: 'Abdome Agudo', children: [
                    { name: 'Abdome Agudo Inflamatório', children: ['Apendicite Aguda', 'Diverticulite Aguda', 'Colecistite Aguda', 'Colangite Aguda'] },
                    { name: 'Pancreatite', children: ['Pancreatite Aguda', 'Pancreatite Crônica'] },
                    { name: 'Abdome Agudo Obstrutivo', children: ['Obstrução Alta', 'Obstrução Baixa', 'Obstrução Funcional', 'Conceitos Gerais'] },
                    { name: 'Abdome Agudo Perfurativo', children: ['Úlcera Péptica Pefurada', 'Etiologia e Propedêutica'] },
                    { name: 'Abdome Agudo Vascular', children: ['Isquemia Mesentérica Aguda', 'Isquemia Mesentérica Crônica'] }
                ]},
                { name: 'Hérnia de Parede Abdominal', children: ['Anatomia da Parede Abdominal', 'Hérnia Inguinocrural', 'Hérnia Ventral'] },
                { name: 'Técnica Cirúrgica', children: ['Instrumentais Cirúrgicos', 'Videolaparoscopia', 'Cirurgia Robótica'] },
                { name: 'Perioperatório', children: ['Cirurgia Segura', 'Avaliação Pré-Operatória', 'Antibioticoprofilaxia', 'Complicações Pós-Operatórias', 'Protocolos de Recuperação Pós Operatória', 'REMIT', 'Nutrição Perioperatória'] },
                { name: 'Especialidades Cirúrgicas', children: [
                    { name: 'Coloproctologia', children: ['Doença Hemorroidária', 'Fissuras Anais', 'Câncer Colorretal', 'Síndrome Relacionadas ao Câncer Colorretal'] },
                    { name: 'Cirurgia Plástica', children: ['Enxertos', 'Retalhos'] },
                    { name: 'Cicatrização', children: ['Cicatrização Fisiológica', 'Cicatrização Patológica', 'Lesão Por Pressão'] },
                    { name: 'Urologia', children: ['Nefrolitíase', 'Escroto Agudo', 'Hiperplasia Prostática Benigna'] },
                    { name: 'Uro-Oncologia', children: ['Câncer de Próstata', 'Neoplasias Testiculares'] },
                    { name: 'Afecções Penianas', children: ['Priapismo'] },
                    { name: 'Cirurgia Torácica', children: ['Pneumotórax Espontâneo', 'Traqueia'] },
                    { name: 'Cirurgia Vascular', children: ['Oclusão Arterial Crônica', 'Trombose Venosa', 'Insuficiência Venosa Crônica', 'Estenose de Carótidas'] },
                    { name: 'Aneurismas', children: ['Aneurisma de Aorta Abdominal'] },
                    { name: 'Cabeça e Pescoço', children: ['Doenças Congênitas', 'Neoplasias Malignas da Cabeça e Pescoço'] },
                    { name: 'Cirurgia Pediátrica', children: ['Urologia Pediátrica', 'Aparelho Digestivo'] },
                    'Cirurgia Bariátrica e Metabólica'
                ]}
            ]},
            { name: 'CLÍNICA MÉDICA', children: [
                { name: 'Gastroenterologia e Gastrocirurgia', children: [
                    { name: 'Esôfago', children: ['Anatomia e Fisiologia', 'Acalásia e Outros Distúrbios Motores', 'Câncer de Esôfago', 'Divertículos Esofágicos', 'Anéis Esofágicos', 'Doença do Refluxo Gastroesofágico', 'Síndrome de Boerhaave'] },
                    { name: 'Estômago', children: ['Doença Ulcerosa Péptica', 'Câncer Gástrico'] },
                    { name: 'Intestinos', children: ['Disabsorção', 'Doença Inflamatória Intestinal'] },
                    { name: 'Pâncreas', children: ['Neoplasias Císticas Pancreáticas', 'Câncer de Pâncreas'] },
                    { name: 'Vias Biliares', children: ['Anatomia e Fisiologia', 'Colelitíase', 'Coledocolitíase', 'Síndrome de Mirizzi', 'Colangiocarcinoma'] },
                    { name: 'Hemorragias Digestivas', children: [
                        { name: 'Hemorragia Digestiva Alta', children: ['Varicosa', 'Não Varicosa'] }
                    ]}
                ]},
                { name: 'Cardiologia', children: [
                    'Eletrocardiograma',
                    { name: 'Hipertensão Arterial Sistêmica', children: ['Diagnóstico e Estadiamento', 'Tratamento da Hipertensão Arterial Sistêmica', 'Urgências e Emergências Hipertensivas'] },
                    { name: 'Insuficiência cardíaca', children: ['Insuficiência Cardíaca Descompensada'] },
                    { name: 'Síndrome Coronariana Aguda', children: ['Síndrome Coronariana Aguda Sem Supra de ST', 'Infarto Agudo do Miocárdio com Supra de ST'] },
                    { name: 'Arritmias', children: ['Taquiarritmias', { name: 'Bradiarritmias', children: ['Bloqueios Atrioventriculares'] }] },
                    'Condições Associadas ao Pericárdio',
                    'Endocardite Infecciosa',
                    'Risco Cardiovascular'
                ]},
                { name: 'Endocrinologia', children: [
                    { name: 'Diabetes Mellitus', children: ['Diabetes Tipo 1', 'Diabetes Tipo 2', { name: 'Complicações Agudas', children: ['Cetoacidose Diabética', 'Estado Hiperosmolar Hiperglicêmico'] }, 'Complicações Crônicas'] },
                    { name: 'Tireoide', children: ['Hipotireoidismo', 'Tireotoxicose', 'Nódulos Tireoidianos', 'Câncer de tireoide', 'Conceitos Básicos'] },
                    { name: 'Adrenal', children: ['Insuficiência Adrenal', 'Hiperaldosteronismo', 'Conceitos Básicos'] },
                    { name: 'Hipófise', children: ['Síndrome de Cushing', 'Diabetes Insipidus'] },
                    { name: 'Metabolismo ósseo e mineral', children: ['Osteoporose', 'Hiperparatireoidismo', 'Metabolismo do cálcio e da vitamina D', 'Hipercalcemia e Hipocalcemia'] }
                ]},
                { name: 'Hepatologia', children: [
                    { name: 'Hepatites Virais', children: ['Hepatite B', 'Hepatite C'] },
                    { name: 'Cirrose', children: ['Classificações Child-Pugh e MELD', { name: 'Complicações', children: ['Encefalopatia Hepática', 'Peritonite Bacteriana Espontânea'] }] },
                    { name: 'Outras doenças hepáticas', children: ['Doença Hepática Gordurosa Não Alcoólica'] },
                    'Carcinoma Hepatocelular',
                    'Tumores Hepáticos Benignos'
                ]},
                { name: 'Hematologia', children: [
                    { name: 'Anemias', children: ['Definição e Classificação', { name: 'Anemias Microcíticas', children: ['Anemia Ferropriva', 'Anemia de Doença Crônica', 'Talassemia'] }, 'Anemia Falciforme', 'Anemia Megaloblástica', { name: 'Anemias Hemolíticas', children: ['Anemias Microangiopáticas'] }] },
                    { name: 'Oncohematologia', children: ['Síndrome de Lise Tumoral', 'Neutropenia Febril', 'Leucemias Agudas', 'Leucemias Crônicas', { name: 'Gamopatias Monoclonais', children: ['Mieloma Múltiplo'] }] },
                    { name: 'Hemostasia', children: ['Hemostasia Primária', 'Hemostasia Secundária'] }
                ]},
                { name: 'Infectologia', children: [
                    { name: 'Tuberculose', children: ['Tuberculose na infância'] },
                    { name: 'Síndromes Febris', children: [{ name: 'Arboviroses', children: ['Dengue'] }] },
                    'HIV',
                    { name: 'Síndromes Bacterianas', children: ['Pneumonia', 'Infecção do Trato Urinário', 'Sepse'] },
                    { name: 'Parasitoses', children: ['Esquistossomose', 'Ascaridíase', 'Estrongiloidíase', 'Ancilostomose', 'Enterobiose e Oxiuríase', 'Tricuríase', 'Toxocaríase', 'Teníase', 'Cisticercose', 'Amebíase e Giardíase'] },
                    'COVID-19',
                    { name: 'Infecções do Sistema Nervoso Central', children: [{ name: 'Meningite', children: ['Meningite Bacteriana', 'Meningite Tuberculosa'] }, 'Encefalite Herpética'] }
                ]},
                { name: 'Dermatologia', children: [
                    { name: 'Hanseníase', children: ['Estados Reacionais'] },
                    { name: 'Dermatoviroses', children: ['Herpes-Zóster'] },
                    { name: 'Farmacodermias', children: ['Síndrome DRESS'] },
                    { name: 'Câncer de Pele', children: ['Melanoma', 'Câncer de Pele não Melanoma'] }
                ]},
                { name: 'Nefrologia', children: [
                    { name: 'Glomerulopatias', children: [{ name: 'Síndrome Nefrítica', children: ['Glomerulonefrite Pós-Estreptocócica'] }, { name: 'Síndrome Nefrótica', children: ['Doença por Lesões Mínimas'] }, { name: 'Alterações Urinárias Assintomáticas', children: ['Nefropatia por IgA de Berger'] }] },
                    { name: 'Distúrbios Hidroeletrolíticos', children: [{ name: 'Distúrbios do Potássio', children: ['Hipercalemia', 'Hipocalemia'] }, { name: 'Distúrbios do Sódio', children: ['Hipernatremia', 'Hiponatremia'] }] },
                    { name: 'Distúrbios Ácido-Base', children: ['Acidose Metabólica', 'Acidose Respiratória e Alcalose Respiratória'] },
                    'Doenças Tubulointersticiais',
                    'Injúria Renal Aguda',
                    'Doença Renal Crônica'
                ]},
                { name: 'Neurologia', children: [
                    'Nervos cranianos',
                    'Delirium',
                    'Morte Encefálica',
                    { name: 'Cefaleias', children: [{ name: 'Cefaleias Primárias', children: ['Cefaleia Tensional', 'Enxaqueca', 'Cefaleia em Salvas'] }, 'Cefaleias Secundárias', 'Neuralgia Trigeminal'] },
                    { name: 'Demências', children: ['Doença de Alzheimer', 'Demência Frontotemporal', 'Demência com Corpos de Lewy'] },
                    { name: 'Epilepsia', children: ['Conceitos e Classificação', { name: 'Síndromes Epilépticas', children: ['Síndrome de West', 'Epilepsia Mioclônica Juvenil'] }, 'Status Epilepticus'] },
                    { name: 'Distúrbios do Movimento', children: ['Doença de Parkinson', 'Tremor Essencial'] },
                    { name: 'Doenças Neuromusculares', children: ['Esclerose Lateral Amiotrófica', 'Síndrome de Guillain-Barré', 'Miastenia Gravis', { name: 'Mononeuropatias', children: ['Síndrome do Túnel do Carpo'] }] },
                    { name: 'Acidente Vascular Cerebral', children: [{ name: 'AVC Isquêmico', children: ['Epidemiologia, Fisiopatologia e Clínica', 'Diagnóstico, NIHSS e Exames de Imagem', 'Tratamento'] }, 'Ataque Isquêmico Transitório', { name: 'AVC Hemorrágico', children: ['Hemorragia Subaracnoidea Espontânea', 'Hemorragia Intraparenquimatosa'] }] },
                    { name: 'Doenças Imunológicas do SNC', children: ['Esclerose Múltipla', 'Neuromielite Óptica de Devic'] },
                    { name: 'Síndromes Neurológicas', children: ['Síndromes do Neurônio Motor Superior e Inferior', 'Síndromes Sensitivas'] }
                ]},
                { name: 'Pneumologia', children: [
                    'Derrame Pleural',
                    'Câncer de Pulmão',
                    { name: 'Suporte Ventilatório', children: ['Ventilação Mecânica'] },
                    'Síndrome do Desconforto Respiratório Agudo',
                    { name: 'Doença Pulmonar Obstrutiva Crônica', children: ['DPOC Exacerbada'] },
                    'Tromboembolismo Pulmonar'
                ]},
                { name: 'Reumatologia', children: [
                    { name: 'Artropatias Inflamatórias', children: ['Artrite Reumatoide', { name: 'Artrite por Cristais', children: ['Gota', 'Pseudogota'] }] },
                    { name: 'Colagenoses', children: ['Lúpus Eritematoso Sistêmico', 'Síndrome de Sjögren', 'Dermatomiosite e Polimiosite', 'Síndrome do Anticorpo Antifosfolípide'] },
                    { name: 'Vasculites', children: [{ name: 'Vasculites de Grandes Vasos', children: ['Arterite de Células Gigantes ou Arterite Temporal', 'Arterite de Takayasu'] }, { name: 'Vasculites de Médios Vasos', children: ['Poliarterite Nodosa', 'Crioglobulinemia'] }, { name: 'Vasculites de Pequenos Vasos', children: ['Granulomatose com Poliangeíte ou Wegener', 'Granulomatose Eosinofílica com Poliangeíte ou Churg-Strauss'] }, { name: 'Outras Vasculites', children: ['Síndrome de Behçet', 'Tromboangeíte Obliterante ou Buerger'] }] },
                    'Osteoartrite'
                ]},
                { name: 'Toxicologia', children: [
                    { name: 'Acidentes Ofídicos', children: ['Acidente Botrópico', 'Acidente Crotálico', 'Acidente Laquético', 'Acidente Elapídico'] },
                    'Escorpionismo',
                    'Araneísmo',
                    { name: 'Intoxicação por Drogas', children: ['Cocaína', 'Organofosforados e Carbamatos'] }
                ]}
            ]},
            { name: 'MEDICINA PREVENTIVA E SOCIAL', children: [
                { name: 'SUS', children: ['História', { name: 'Princípios e Diretrizes', children: ['Atributos Gerais da APS', 'Princípios e Diretrizes do SUS'] }, 'Financiamento', 'Políticas e Programas'] },
                { name: 'Epidemiologia', children: [{ name: 'Introdução', children: ['Conceitos básicos', 'Determinantes Sociais de Saúde'] }, { name: 'Prevenção em Saúde', children: ['Níveis de Prevenção', 'Rastreamentos'] }, 'Medidas de Saúde Coletiva', 'Epidemias, Endemias, Pandemias e Surtos'] },
                { name: 'Estatística', children: ['Estudos Epidemiológicos', 'Testes Diagnósticos', 'Medidas de frequência e associação', 'Variáveis e Medidas Resumo'] },
                { name: 'Ética e Bioética', children: ['Conceitos Fundamentais', 'Código de Ética Médica'] },
                'Medicina de Família e Comunidade',
                { name: 'Vigilância em Saúde', children: ['Sistemas de Informação', 'Lista de Doenças de Notificação Compulsória', 'Declaração de Óbito (DO)/ Atestado de Óbito'] },
                { name: 'Saúde do Trabalhador', children: ['Acidente de Trabalho', 'Doenças Ocupacionais'] }
            ]},
            { name: 'GINECOLOGIA E OBSTETRÍCIA', children: [
                { name: 'Ginecologia', children: [
                    { name: 'Bases da Ginecologia', children: ['Anatomia do Sistema Reprodutor Feminino', 'Embriologia do Sistema Reprodutor Feminino', 'Ciclo Menstrual'] },
                    { name: 'Contracepção e Planejamento Familiar', children: ['Infertilidade', { name: 'Métodos Contraceptivos', children: ['Métodos Comportamentais', 'Métodos de Barreira', 'Métodos Hormonais Combinados', 'Métodos Hormonais Com Progesterona Isolada', 'Dispositivos Intrauterinos', 'Contracepção de Emergência', 'Métodos Cirúrgicos', 'Conceitos Básicos'] }] },
                    { name: 'Uroginecologia', children: [{ name: 'Incontinência Urinária', children: ['Síndrome da Bexiga Dolorosa'] }] },
                    { name: 'Mastologia', children: ['Afecções Benignas da Mama', 'Câncer de Mama'] },
                    { name: 'Oncologia Ginecológica', children: ['Colo do Útero', 'Endométrio', { name: 'Ovários e Anexos', children: ['Tumores Ovarianos Benignos', 'Câncer de Ovário'] }] },
                    { name: 'Ginecologia Endócrina', children: [{ name: 'Distúrbios Menstruais', children: [{ name: 'Amenorreia', children: ['Amenorreia Secundária'] }] }, 'Climatério', { name: 'Síndromes Hiperandrogênicas', children: ['Síndrome de Ovários Policísticos'] }] },
                    { name: 'Ginecologia Geral', children: [{ name: 'Sangramento Uterino', children: ['Sangramento Uterino Anormal'] }, { name: 'Infecções em Ginecologia', children: ['Cervicites', 'Doença Inflamatória Pélvica', 'Úlceras Genitais', 'Vulvovaginites'] }, 'Violência Sexual', 'Dor Pélvica', 'Sexualidade'] }
                ]},
                { name: 'Obstetrícia', children: [
                    { name: 'Gestação', children: ['Modificações Fisiológicas do Organismo Materno', 'Diagnóstico e Data Provável do Parto', 'Assistência Pré-Natal'] },
                    { name: 'Parto', children: ['Bacia Obstétrica e Pelvimetria', 'Estática Fetal', 'Mecanismo de Parto', 'Distocias', 'Partograma', 'Assistência ao Parto Normal', 'Assistência ao Parto Pélvico', 'Indução de Parto', 'Parto Vaginal Operatório', 'Parto Cesárea'] },
                    { name: 'Puerpério', children: [{ name: 'Puerpério Patológico', children: ['Hemorragia Pós-Parto', 'Infecções Puerperais'] }] },
                    { name: 'Obstetrícia Patológica', children: [{ name: 'Síndromes Hemorrágicas da Gestação', children: [{ name: 'Sangramento da Primeira Metade', children: ['Abortamento', 'Gestação Ectópica', 'Doença Trofoblástica Gestacional'] }, { name: 'Sangramento da Segunda Metade', children: ['Placenta Prévia', 'Descolamento Prematuro de Placenta'] }] }, 'Trabalho de Parto Prematuro', 'Rotura Prematura de Membranas Ovulares (RPMO)', 'Gemelaridade', 'Doença Hemolítica Perinatal (DHPN)', 'Crescimento Intra-Uterino Restrito (CIUR)', 'Abortamento Habitual e Insuficiência Istmocervical'] },
                    { name: 'Doenças Associadas à Gestação', children: ['Síndromes Hipertensivas na Gestação', 'Diabetes Mellitus Gestacional (DMG)', 'Doenças Infecciosas na Gestação', 'Colagenoses na Gestação', 'Trombofilias e Trombose na Gestação', 'Cardiopatias na Gestação', 'Anemias na Gestação', 'Hiperêmese Gravídica'] },
                    { name: 'Medicina Fetal', children: [{ name: 'Vitalidade Fetal', children: ['Cardiotocografia', 'Dopplervelocimetria', 'Perfil Biofisico Fetal'] }, 'Líquido Amniótico', { name: 'Sofrimento Fetal', children: ['Sofrimento Fetal Agudo', 'Sofrimento Fetal Crônico'] }] }
                ]}
            ]},
            { name: 'PEDIATRIA', children: [
                { name: 'Especialidades Pediátricas', children: [
                    { name: 'Neonatologia', children: [{ name: 'Doenças do Período Neonatal', children: ['Distúrbios Respiratórios do Período Neonatal', 'Infecções Congênitas', 'Icterícia Neonatal', 'Sepse Neonatal', 'Principais Síndromes Genéticas e Neonatais'] }, { name: 'Sala de Parto', children: ['Reanimação Neonatal', 'Classificação do Recém-Nascido'] }, { name: 'Cuidados Pós-Natais e Distúrbios do Metabolismo', children: ['Exame Físico do Recém-Nascido', 'Triagem Neonatal', { name: 'Distúrbios Metabólicos do Período Neonatal', children: [{ name: 'Distúrbios da Glicose', children: ['Hipoglicemia Neonatal'] }] }] }] },
                    { name: 'Cardiologia Pediátrica', children: ['Transição Circulação Fetal para Neonatal', 'Cardiopatias Congênitas', 'Sopro na Infância', 'Hipertensão Arterial Sistêmica na Infância'] },
                    { name: 'Pneumologia Pediátrica', children: ['Asma', 'Fibrose Cística'] },
                    { name: 'Infectologia Pediátrica', children: [{ name: 'Doenças Exantemáticas', children: ['Mononucleose Infecciosa', 'Síndrome Mão-Pé-Boca', 'Sarampo', 'Exantema Súbito', 'Eritema Infeccioso', 'Varicela'] }, 'Febre Sem Sinais Localizatórios', { name: 'Infecções das Vias Aéreas', children: ['Infecções do Trato Respiratório Superior', { name: 'Infecções do Trato Respiratório Inferior', children: ['Pneumonias', 'Bronquiolite Viral Aguda', 'Coqueluche'] }] }] },
                    { name: 'Gastroenterologia Pediátrica', children: [{ name: 'Diarreia', children: ['Diarreia Aguda na Infância'] }, { name: 'Outras Doenças da Gastropediatria', children: ['Constipação', 'Alergias Alimentares', { name: 'Refluxo Gastroesofágico na Infância', children: ['Doença do Refluxo Gastroesofágico'] }] }] },
                    { name: 'Nefrologia Pediátrica', children: ['Infecção de Trato Urinário na Infância'] },
                    { name: 'Neurologia Pediátrica', children: [{ name: 'Meningoencefalites na Infância', children: ['Meningite Viral', 'Meningite Bacteriana'] }, 'Transtornos Convulsivos na Infância'] },
                    { name: 'Reumatologia Pediátrica', children: ['Doença de Kawasaki', 'Púrpura de Henoch-Schonlein', 'Artrite Idopática Juvenil', 'Febre Reumática'] },
                    { name: 'Endocrinologia Pediátrica', children: ['Hipotireoidismo Congênito', 'Desordens do Desenvolvimento Sexual', 'Hiperplasia Adrenal Congênita', { name: 'Puberdade', children: ['Puberdade Normal', { name: 'Puberdade Anormal', children: ['Puberdade Precoce', 'Atraso Puberal'] }] }] }
                ]},
                { name: 'Emergências Pediátricas', children: ['Parada Cardiorrespiratória', 'Arritmias', 'Choque', 'Anafilaxia e Urticária', 'OVACE e Ingestão de Corpo Estranho', 'BRUE e Síndrome da Morte Súbita do Lactente'] },
                'Violência contra a Criança',
                'Hebiatria',
                { name: 'Puericultura', children: [
                    'Vacinas e Imunizações',
                    { name: 'Aleitamento Materno e Nutrição Infantil', children: ['Aleitamento Materno', { name: 'Introdução Alimentar, Suplementação e Distúrbios Nutricionais', children: ['Introdução Alimentar', { name: 'Suplementação Vitamínica e Sais Minerais', children: ['Ferro', 'Vitamina D'] }, { name: 'Distúrbios Nutricionais', children: ['Obesidade', 'Desnutrição', 'Hipovitaminoses'] }] }] },
                    { name: 'Crescimento e Desenvolvimento Neuropsicomotor', children: ['Crescimento', { name: 'Desenvolvimento Neuropsicomotor', children: ['Desenvolvimento Neuropsicomotor Normal'] }] },
                    'Puericultura Geral'
                ]}
            ]},
            { name: 'OUTROS', children: [
                { name: 'Ortopedia', children: ['Ortopedia Pediátrica'] }
            ]}
        ];

        // Lista de assuntos para a Revisão Espaçada (simulada)
        const subjectsDataRevisao = [
            'Trauma Abdominal e Pélvico',
            'Choque Hemorrágico',
            'Insuficiência Cardíaca (com foco em Descompensada)',
            'Diabetes Mellitus (Tipo 1, Tipo 2, Complicações Agudas e Crônicas)',
            'Glomerulopatias'
        ];

        // Configuração dos Decks de Flashcards (Caminhos e Contagens)
        const TREINO_LIVRE_REVIEWS_KEY = 'flashcardReviews_treinoLivre';
        const REVISAO_ESPACADA_REVIEWS_KEY = 'flashcardReviews_revisaoEspacada';
        const STUDY_TIME_KEY_TREINO = 'dailyStudyTime_treinoLivre';
        const STUDY_TIME_KEY_REVISAO = 'dailyStudyTime_revisaoEspacada';
        
        // Decks para TREINO LIVRE (populados com base na lista completa e quantidades)
        const treinoLivreDecks = [
        { path: "CIRURGIA GERAL/Trauma/Avaliação Inicial", count: 23 },
        { path: "CIRURGIA GERAL/Trauma/Via Aérea e Ventilação", count: 42 },
        { path: "CIRURGIA GERAL/Trauma/Choque Hemorrágico", count: 64 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Torácico", count: 42 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Abdominal e Pélvico", count: 75 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Raquimedular", count: 31 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Cranioencefálico", count: 40 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Musculoesquelético", count: 20 },
        { path: "CIRURGIA GERAL/Trauma/Trauma em Populações Especiais", count: 14 },
        { path: "CIRURGIA GERAL/Trauma/Queimaduras e Trauma Elétrico", count: 37 },
        { path: "CIRURGIA GERAL/Trauma/Trauma Cervical", count: 23 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Inflamatório/Apendicite Aguda", count: 68 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Inflamatório/Diverticulite Aguda", count: 37 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Inflamatório/Colecistite Aguda", count: 40 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Inflamatório/Colangite Aguda", count: 20 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Pancreatite/Pancreatite Aguda", count: 59 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Pancreatite/Pancreatite Crônica", count: 17 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Obstrutivo/Obstrução Alta", count: 18 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Obstrutivo/Obstrução Baixa", count: 16 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Obstrutivo/Obstrução Funcional", count: 6 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Obstrutivo/Conceitos Gerais", count: 19 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Perfurativo/Úlcera Péptica Pefurada", count: 9 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Perfurativo/Etiologia e Propedêutica", count: 10 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Vascular/Isquemia Mesentérica Aguda", count: 24 },
        { path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Vascular/Isquemia Mesentérica Crônica", count: 12 },
        { path: "CIRURGIA GERAL/Hérnia de Parede Abdominal/Anatomia da Parede Abdominal", count: 24 },
        { path: "CIRURGIA GERAL/Hérnia de Parede Abdominal/Hérnia Inguinocrural", count: 67 },
        { path: "CIRURGIA GERAL/Hérnia de Parede Abdominal/Hérnia Ventral", count: 35 },
        { path: "CIRURGIA GERAL/Técnica Cirúrgica/Instrumentais Cirúrgicos", count: 14 },
        { path: "CIRURGIA GERAL/Técnica Cirúrgica/Videolaparoscopia", count: 14 },
        { path: "CIRURGIA GERAL/Técnica Cirúrgica/Cirurgia Robótica", count: 5 },
        { path: "CIRURGIA GERAL/Perioperatório/Cirurgia Segura", count: 9 },
        { path: "CIRURGIA GERAL/Perioperatório/Avaliação Pré-Operatória", count: 24 },
        { path: "CIRURGIA GERAL/Perioperatório/Antibioticoprofilaxia", count: 18 },
        { path: "CIRURGIA GERAL/Perioperatório/Complicações Pós-Operatórias", count: 45 },
        { path: "CIRURGIA GERAL/Perioperatório/Protocolos de Recuperação Pós Operatória", count: 38 },
        { path: "CIRURGIA GERAL/Perioperatório/REMIT", count: 30 },
        { path: "CIRURGIA GERAL/Perioperatório/Nutrição Perioperatória", count: 20 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Coloproctologia/Doença Hemorroidária", count: 42 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Coloproctologia/Fissuras Anais", count: 30 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Coloproctologia/Câncer Colorretal", count: 48 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Coloproctologia/Síndrome Relacionadas ao Câncer Colorretal", count: 22 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Plástica/Enxertos", count: 22 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Plástica/Retalhos", count: 29 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cicatrização/Cicatrização Fisiológica", count: 22 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cicatrização/Cicatrização Patológica", count: 28 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cicatrização/Lesão Por Pressão", count: 16 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Urologia/Nefrolitíase", count: 48 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Urologia/Escroto Agudo", count: 35 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Urologia/Hiperplasia Prostática Benigna", count: 45 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Uro-Oncologia/Câncer de Próstata", count: 57 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Uro-Oncologia/Neoplasias Testiculares", count: 18 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Afecções Penianas/Priapismo", count: 16 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Torácica/Pneumotórax Espontâneo", count: 15 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Torácica/Traqueia", count: 13 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Vascular/Oclusão Arterial Crônica", count: 34 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Vascular/Trombose Venosa", count: 42 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Vascular/Insuficiência Venosa Crônica", count: 23 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Vascular/Estenose de Carótidas", count: 20 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Aneurismas/Aneurisma de Aorta Abdominal", count: 27 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cabeça e Pescoço/Doenças Congênitas", count: 15 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cabeça e Pescoço/Neoplasias Malignas da Cabeça e Pescoço", count: 27 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Pediátrica/Urologia Pediátrica", count: 44 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Pediátrica/Aparelho Digestivo", count: 42 },
        { path: "CIRURGIA GERAL/Especialidades Cirúrgicas/Cirurgia Bariátrica e Metabólica", count: 39 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Anatomia e Fisiologia", count: 6 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Acalásia e Outros Distúrbios Motores", count: 74 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Câncer de Esôfago", count: 27 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Divertículos Esofágicos", count: 51 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Anéis Esofágicos", count: 3 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Doença do Refluxo Gastroesofágico", count: 35 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Esôfago/Síndrome de Boerhaave", count: 5 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Estômago/Doença Ulcerosa Péptica", count: 56 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Estômago/Câncer Gástrico", count: 34 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Intestinos/Disabsorção", count: 48 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Intestinos/Doença Inflamatória Intestinal", count: 34 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Pâncreas/Neoplasias Císticas Pancreáticas", count: 23 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Pâncreas/Câncer de Pâncreas", count: 25 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Vias Biliares/Anatomia e Fisiologia", count: 25 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Vias Biliares/Colelitíase", count: 21 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Vias Biliares/Coledocolitíase", count: 37 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Vias Biliares/Síndrome de Mirizzi", count: 11 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Vias Biliares/Colangiocarcinoma", count: 13 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Hemorragias Digestivas/Hemorragia Digestiva Alta/Varicosa", count: 27 },
        { path: "CLÍNICA MÉDICA/Gastroenterologia e Gastrocirurgia/Hemorragias Digestivas/Hemorragia Digestiva Alta/Não Varicosa", count: 34 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Eletrocardiograma", count: 55 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Hipertensão Arterial Sistêmica/Diagnóstico e Estadiamento", count: 11 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Hipertensão Arterial Sistêmica/Tratamento da Hipertensão Arterial Sistêmica", count: 24 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Hipertensão Arterial Sistêmica/Urgências e Emergências Hipertensivas", count: 11 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Insuficiência cardíaca/Insuficiência Cardíaca Descompensada", count: 31 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Síndrome Coronariana Aguda/Síndrome Coronariana Aguda Sem Supra de ST", count: 13 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Síndrome Coronariana Aguda/Infarto Agudo do Miocárdio com Supra de ST", count: 36 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Arritmias/Taquiarritmias", count: 53 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Arritmias/Bradiarritmias/Bloqueios Atrioventriculares", count: 33 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Condições Associadas ao Pericárdio", count: 38 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Endocardite Infecciosa", count: 48 },
        { path: "CLÍNICA MÉDICA/Cardiologia/Risco Cardiovascular", count: 47 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Diabetes Mellitus/Diabetes Tipo 1", count: 8 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Diabetes Mellitus/Diabetes Tipo 2", count: 50 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Diabetes Mellitus/Complicações Agudas/Cetoacidose Diabética", count: 42 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Diabetes Mellitus/Complicações Agudas/Estado Hiperosmolar Hiperglicêmico", count: 8 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Diabetes Mellitus/Complicações Crônicas", count: 17 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Tireoide/Hipotireoidismo", count: 25 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Tireoide/Tireotoxicose", count: 52 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Tireoide/Nódulos Tireoidianos", count: 19 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Tireoide/Câncer de tireoide", count: 40 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Tireoide/Conceitos Básicos", count: 21 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Adrenal/Insuficiência Adrenal", count: 57 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Adrenal/Hiperaldosteronismo", count: 27 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Adrenal/Conceitos Básicos", count: 24 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Hipófise/Síndrome de Cushing", count: 33 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Hipófise/Diabetes Insipidus", count: 13 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Metabolismo ósseo e mineral/Osteoporose", count: 78 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Metabolismo ósseo e mineral/Hiperparatireoidismo", count: 16 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Metabolismo ósseo e mineral/Metabolismo do cálcio e da vitamina D", count: 34 },
        { path: "CLÍNICA MÉDICA/Endocrinologia/Metabolismo ósseo e mineral/Hipercalcemia e Hipocalcemia", count: 43 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Hepatites Virais/Hepatite B", count: 44 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Hepatites Virais/Hepatite C", count: 28 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Cirrose/Classificações Child-Pugh e MELD", count: 55 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Cirrose/Complicações/Encefalopatia Hepática", count: 26 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Cirrose/Complicações/Peritonite Bacteriana Espontânea", count: 18 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Outras doenças hepáticas/Doença Hepática Gordurosa Não Alcoólica", count: 31 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Carcinoma Hepatocelular", count: 32 },
        { path: "CLÍNICA MÉDICA/Hepatologia/Tumores Hepáticos Benignos", count: 35 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Definição e Classificação", count: 15 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemias Microcíticas/Anemia Ferropriva", count: 29 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemias Microcíticas/Anemia de Doença Crônica", count: 5 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemias Microcíticas/Talassemia", count: 12 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemia Falciforme", count: 46 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemia Megaloblástica", count: 37 },
        { path: "CLÍNICA MÉDICA/Hematologia/Anemias/Anemias Hemolíticas/Anemias Microangiopáticas", count: 17 },
        { path: "CLÍNICA MÉDICA/Hematologia/Oncohematologia/Síndrome de Lise Tumoral", count: 17 },
        { path: "CLÍNICA MÉDICA/Hematologia/Oncohematologia/Neutropenia Febril", count: 12 },
        { path: "CLÍNICA MÉDICA/Hematologia/Oncohematologia/Leucemias Agudas", count: 22 },
        { path: "CLÍNICA MÉDICA/Hematologia/Oncohematologia/Leucemias Crônicas", count: 14 },
        { path: "CLÍNICA MÉDICA/Hematologia/Oncohematologia/Gamopatias Monoclonais/Mieloma Múltiplo", count: 26 },
        { path: "CLÍNICA MÉDICA/Hematologia/Hemostasia/Hemostasia Primária", count: 29 },
        { path: "CLÍNICA MÉDICA/Hematologia/Hemostasia/Hemostasia Secundária", count: 31 },
        { path: "CLÍNICA MÉDICA/Infectologia/Tuberculose/Tuberculose na infância", count: 26 },
        { path: "CLÍNICA MÉDICA/Infectologia/Síndromes Febris/Arboviroses/Dengue", count: 50 },
        { path: "CLÍNICA MÉDICA/Infectologia/HIV", count: 326 },
        { path: "CLÍNICA MÉDICA/Infectologia/Síndromes Bacterianas/Pneumonia", count: 78 },
        { path: "CLÍNICA MÉDICA/Infectologia/Síndromes Bacterianas/Infecção do Trato Urinário", count: 52 },
        { path: "CLÍNICA MÉDICA/Infectologia/Síndromes Bacterianas/Sepse", count: 25 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Esquistossomose", count: 36 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Ascaridíase", count: 20 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Estrongiloidíase", count: 16 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Ancilostomose", count: 12 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Enterobiose e Oxiuríase", count: 10 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Tricuríase", count: 10 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Toxocaríase", count: 13 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Teníase", count: 14 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Cisticercose", count: 22 },
        { path: "CLÍNICA MÉDICA/Infectologia/Parasitoses/Amebíase e Giardíase", count: 40 },
        { path: "CLÍNICA MÉDICA/Infectologia/COVID-19", count: 43 },
        { path: "CLÍNICA MÉDICA/Infectologia/Infecções do Sistema Nervoso Central/Meningite/Meningite Bacteriana", count: 23 },
        { path: "CLÍNICA MÉDICA/Infectologia/Infecções do Sistema Nervoso Central/Meningite/Meningite Tuberculosa", count: 15 },
        { path: "CLÍNICA MÉDICA/Infectologia/Infecções do Sistema Nervoso Central/Encefalite Herpética", count: 13 },
        { path: "CLÍNICA MÉDICA/Dermatologia/Hanseníase/Estados Reacionais", count: 15 },
        { path: "CLÍNICA MÉDICA/Dermatologia/Dermatoviroses/Herpes-Zóster", count: 22 },
        { path: "CLÍNICA MÉDICA/Dermatologia/Farmacodermias/Síndrome DRESS", count: 1 },
        { path: "CLÍNICA MÉDICA/Dermatologia/Câncer de Pele/Melanoma", count: 24 },
        { path: "CLÍNICA MÉDICA/Dermatologia/Câncer de Pele/Câncer de Pele não Melanoma", count: 13 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Glomerulopatias/Síndrome Nefrítica/Glomerulonefrite Pós-Estreptocócica", count: 23 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Glomerulopatias/Síndrome Nefrótica/Doença por Lesões Mínimas", count: 18 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Glomerulopatias/Alterações Urinárias Assintomáticas/Nefropatia por IgA de Berger", count: 17 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Hidroeletrolíticos/Distúrbios do Potássio/Hipercalemia", count: 23 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Hidroeletrolíticos/Distúrbios do Potássio/Hipocalemia", count: 31 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Hidroeletrolíticos/Distúrbios do Sódio/Hipernatremia", count: 17 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Hidroeletrolíticos/Distúrbios do Sódio/Hiponatremia", count: 53 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Ácido-Base/Acidose Metabólica", count: 40 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Distúrbios Ácido-Base/Acidose Respiratória e Alcalose Respiratória", count: 27 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Doenças Tubulointersticiais", count: 20 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Injúria Renal Aguda", count: 51 },
        { path: "CLÍNICA MÉDICA/Nefrologia/Doença Renal Crônica", count: 137 },
        { path: "CLÍNICA MÉDICA/Neurologia/Nervos cranianos", count: 18 },
        { path: "CLÍNICA MÉDICA/Neurologia/Delirium", count: 21 },
        { path: "CLÍNICA MÉDICA/Neurologia/Morte Encefálica", count: 26 },
        { path: "CLÍNICA MÉDICA/Neurologia/Cefaleias/Cefaleias Primárias/Cefaleia Tensional", count: 13 },
        { path: "CLÍNICA MÉDICA/Neurologia/Cefaleias/Cefaleias Primárias/Enxaqueca", count: 1 },
        { path: "CLÍNICA MÉDICA/Neurologia/Cefaleias/Cefaleias Primárias/Cefaleia em Salvas", count: 1 },
        { path: "CLÍNICA MÉDICA/Neurologia/Cefaleias/Cefaleias Secundárias", count: 29 },
        { path: "CLÍNICA MÉDICA/Neurologia/Cefaleias/Neuralgia Trigeminal", count: 13 },
        { path: "CLÍNICA MÉDICA/Neurologia/Demências/Doença de Alzheimer", count: 14 },
        { path: "CLÍNICA MÉDICA/Neurologia/Demências/Demência Frontotemporal", count: 12 },
        { path: "CLÍNICA MÉDICA/Neurologia/Demências/Demência com Corpos de Lewy", count: 15 },
        { path: "CLÍNICA MÉDICA/Neurologia/Epilepsia/Conceitos e Classificação", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Epilepsia/Síndromes Epilépticas/Síndrome de West", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Epilepsia/Síndromes Epilépticas/Epilepsia Mioclônica Juvenil", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Epilepsia/Status Epilepticus", count: 22 },
        { path: "CLÍNICA MÉDICA/Neurologia/Distúrbios do Movimento/Doença de Parkinson", count: 16 },
        { path: "CLÍNICA MÉDICA/Neurologia/Distúrbios do Movimento/Tremor Essencial", count: 7 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Neuromusculares/Esclerose Lateral Amiotrófica", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Neuromusculares/Síndrome de Guillain-Barré", count: 15 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Neuromusculares/Miastenia Gravis", count: 26 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Neuromusculares/Mononeuropatias/Síndrome do Túnel do Carpo", count: 20 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/AVC Isquêmico/Epidemiologia, Fisiopatologia e Clínica", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/AVC Isquêmico/Diagnóstico, NIHSS e Exames de Imagem", count: 44 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/AVC Isquêmico/Tratamento", count: 35 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/Ataque Isquêmico Transitório", count: 11 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/AVC Hemorrágico/Hemorragia Subaracnoidea Espontânea", count: 18 },
        { path: "CLÍNICA MÉDICA/Neurologia/Acidente Vascular Cerebral/AVC Hemorrágico/Hemorragia Intraparenquimatosa", count: 19 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Imunológicas do SNC/Esclerose Múltipla", count: 27 },
        { path: "CLÍNICA MÉDICA/Neurologia/Doenças Imunológicas do SNC/Neuromielite Óptica de Devic", count: 13 },
        { path: "CLÍNICA MÉDICA/Neurologia/Síndromes Neurológicas/Síndromes do Neurônio Motor Superior e Inferior", count: 25 },
        { path: "CLÍNICA MÉDICA/Neurologia/Síndromes Neurológicas/Síndromes Sensitivas", count: 32 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Derrame Pleural", count: 39 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Câncer de Pulmão", count: 54 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Suporte Ventilatório/Ventilação Mecânica", count: 9 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Síndrome do Desconforto Respiratório Agudo", count: 7 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Doença Pulmonar Obstrutiva Crônica/DPOC Exacerbada", count: 15 },
        { path: "CLÍNICA MÉDICA/Pneumologia/Tromboembolismo Pulmonar", count: 30 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Artropatias Inflamatórias/Artrite Reumatoide", count: 47 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Artropatias Inflamatórias/Artrite por Cristais/Gota", count: 1 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Artropatias Inflamatórias/Artrite por Cristais/Pseudogota", count: 9 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Colagenoses/Lúpus Eritematoso Sistêmico", count: 57 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Colagenoses/Síndrome de Sjögren", count: 18 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Colagenoses/Dermatomiosite e Polimiosite", count: 18 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Colagenoses/Síndrome do Anticorpo Antifosfolípide", count: 11 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Grandes Vasos/Arterite de Células Gigantes ou Arterite Temporal", count: 19 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Grandes Vasos/Arterite de Takayasu", count: 17 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Médios Vasos/Poliarterite Nodosa", count: 13 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Médios Vasos/Crioglobulinemia", count: 13 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Pequenos Vasos/Granulomatose com Poliangeíte ou Wegener", count: 17 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Vasculites de Pequenos Vasos/Granulomatose Eosinofílica com Poliangeíte ou Churg-Strauss", count: 14 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Outras Vasculites/Síndrome de Behçet", count: 23 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Vasculites/Outras Vasculites/Tromboangeíte Obliterante ou Buerger", count: 12 },
        { path: "CLÍNICA MÉDICA/Reumatologia/Osteoartrite", count: 20 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Acidentes Ofídicos/Acidente Botrópico", count: 16 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Acidentes Ofídicos/Acidente Crotálico", count: 16 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Acidentes Ofídicos/Acidente Laquético", count: 10 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Acidentes Ofídicos/Acidente Elapídico", count: 13 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Escorpionismo", count: 16 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Araneísmo", count: 17 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Intoxicação por Drogas/Cocaína", count: 1 },
        { path: "CLÍNICA MÉDICA/Toxicologia/Intoxicação por Drogas/Organofosforados e Carbamatos", count: 9 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/SUS/História", count: 22 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/SUS/Princípios e Diretrizes/Atributos Gerais da APS", count: 27 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/SUS/Princípios e Diretrizes/Princípios e Diretrizes do SUS", count: 31 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/SUS/Financiamento", count: 33 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/SUS/Políticas e Programas", count: 43 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Introdução/Conceitos básicos", count: 20 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Introdução/Determinantes Sociais de Saúde", count: 21 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Prevenção em Saúde/Níveis de Prevenção", count: 41 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Prevenção em Saúde/Rastreamentos", count: 56 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Medidas de Saúde Coletiva", count: 77 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Epidemiologia/Epidemias, Endemias, Pandemias e Surtos", count: 60 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Estatística/Estudos Epidemiológicos", count: 68 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Estatística/Testes Diagnósticos", count: 42 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Estatística/Medidas de frequência e associação", count: 21 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Estatística/Variáveis e Medidas Resumo", count: 14 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Ética e Bioética/Conceitos Fundamentais", count: 10 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Ética e Bioética/Código de Ética Médica", count: 35 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Medicina de Família e Comunidade", count: 41 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Vigilância em Saúde/Sistemas de Informação", count: 12 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Vigilância em Saúde/Lista de Doenças de Notificação Compulsória", count: 33 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Vigilância em Saúde/Declaração de Óbito (DO)/ Atestado de Óbito", count: 31 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Saúde do Trabalhador/Acidente de Trabalho", count: 66 },
        { path: "MEDICINA PREVENTIVA E SOCIAL/Saúde do Trabalhador/Doenças Ocupacionais", count: 102 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Bases da Ginecologia/Anatomia do Sistema Reprodutor Feminino", count: 11 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Bases da Ginecologia/Embriologia do Sistema Reprodutor Feminino", count: 12 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Bases da Ginecologia/Ciclo Menstrual", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Infertilidade", count: 16 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Métodos Comportamentais", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Métodos de Barreira", count: 16 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Métodos Hormonais Combinados", count: 42 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Métodos Hormonais Com Progesterona Isolada", count: 40 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Dispositivos Intrauterinos", count: 55 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Contracepção de Emergência", count: 22 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Métodos Cirúrgicos", count: 18 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Contracepção e Planejamento Familiar/Métodos Contraceptivos/Conceitos Básicos", count: 40 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Uroginecologia/Incontinência Urinária/Síndrome da Bexiga Dolorosa", count: 4 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Mastologia/Afecções Benignas da Mama", count: 47 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Mastologia/Câncer de Mama", count: 50 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Oncologia Ginecológica/Colo do Útero", count: 46 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Oncologia Ginecológica/Endométrio", count: 12 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Oncologia Ginecológica/Ovários e Anexos/Tumores Ovarianos Benignos", count: 16 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Oncologia Ginecológica/Ovários e Anexos/Câncer de Ovário", count: 19 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Endócrina/Distúrbios Menstruais/Amenorreia/Amenorreia Secundária", count: 11 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Endócrina/Climatério", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Endócrina/Síndromes Hiperandrogênicas/Síndrome de Ovários Policísticos", count: 21 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Sangramento Uterino/Sangramento Uterino Anormal", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Infecções em Ginecologia/Cervicites", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Infecções em Ginecologia/Doença Inflamatória Pélvica", count: 33 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Infecções em Ginecologia/Úlceras Genitais", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Infecções em Ginecologia/Vulvovaginites", count: 30 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Violência Sexual", count: 17 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Dor Pélvica", count: 13 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Ginecologia/Ginecologia Geral/Sexualidade", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Gestação/Modificações Fisiológicas do Organismo Materno", count: 21 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Gestação/Diagnóstico e Data Provável do Parto", count: 6 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Gestação/Assistência Pré-Natal", count: 63 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Bacia Obstétrica e Pelvimetria", count: 17 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Estática Fetal", count: 10 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Mecanismo de Parto", count: 8 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Distocias", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Partograma", count: 19 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Assistência ao Parto Normal", count: 16 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Assistência ao Parto Pélvico", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Indução de Parto", count: 12 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Parto Vaginal Operatório", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Parto/Parto Cesárea", count: 44 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Puerpério/Puerpério Patológico/Hemorragia Pós-Parto", count: 19 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Puerpério/Puerpério Patológico/Infecções Puerperais", count: 8 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Síndromes Hemorrágicas da Gestação/Sangramento da Primeira Metade/Abortamento", count: 13 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Síndromes Hemorrágicas da Gestação/Sangramento da Primeira Metade/Gestação Ectópica", count: 14 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Síndromes Hemorrágicas da Gestação/Sangramento da Primeira Metade/Doença Trofoblástica Gestacional", count: 8 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Síndromes Hemorrágicas da Gestação/Sangramento da Segunda Metade/Placenta Prévia", count: 11 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Síndromes Hemorrágicas da Gestação/Sangramento da Segunda Metade/Descolamento Prematuro de Placenta", count: 9 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Trabalho de Parto Prematuro", count: 26 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Rotura Prematura de Membranas Ovulares (RPMO)", count: 29 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Gemelaridade", count: 17 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Doença Hemolítica Perinatal (DHPN)", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Crescimento Intra-Uterino Restrito (CIUR)", count: 12 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Obstetrícia Patológica/Abortamento Habitual e Insuficiência Istmocervical", count: 23 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Síndromes Hipertensivas na Gestação", count: 77 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Diabetes Mellitus Gestacional (DMG)", count: 27 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Doenças Infecciosas na Gestação", count: 83 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Colagenoses na Gestação", count: 9 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Trombofilias e Trombose na Gestação", count: 26 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Cardiopatias na Gestação", count: 31 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Anemias na Gestação", count: 9 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Doenças Associadas à Gestação/Hiperêmese Gravídica", count: 17 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Vitalidade Fetal/Cardiotocografia", count: 18 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Vitalidade Fetal/Dopplervelocimetria", count: 6 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Vitalidade Fetal/Perfil Biofisico Fetal", count: 6 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Líquido Amniótico", count: 13 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Sofrimento Fetal/Sofrimento Fetal Agudo", count: 63 },
        { path: "GINECOLOGIA E OBSTETRÍCIA/Obstetrícia/Medicina Fetal/Sofrimento Fetal/Sofrimento Fetal Crônico", count: 1 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Doenças do Período Neonatal/Distúrbios Respiratórios do Período Neonatal", count: 42 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Doenças do Período Neonatal/Infecções Congênitas", count: 32 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Doenças do Período Neonatal/Icterícia Neonatal", count: 44 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Doenças do Período Neonatal/Sepse Neonatal", count: 15 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Doenças do Período Neonatal/Principais Síndromes Genéticas e Neonatais", count: 14 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Sala de Parto/Reanimação Neonatal", count: 53 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Sala de Parto/Classificação do Recém-Nascido", count: 20 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Cuidados Pós-Natais e Distúrbios do Metabolismo/Exame Físico do Recém-Nascido", count: 30 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Cuidados Pós-Natais e Distúrbios do Metabolismo/Triagem Neonatal", count: 21 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neonatologia/Cuidados Pós-Natais e Distúrbios do Metabolismo/Distúrbios Metabólicos do Período Neonatal/Distúrbios da Glicose/Hipoglicemia Neonatal", count: 5 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Cardiologia Pediátrica/Transição Circulação Fetal para Neonatal", count: 5 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Cardiologia Pediátrica/Cardiopatias Congênitas", count: 28 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Cardiologia Pediátrica/Sopro na Infância", count: 5 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Cardiologia Pediátrica/Hipertensão Arterial Sistêmica na Infância", count: 14 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Pneumologia Pediátrica/Asma", count: 101 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Pneumologia Pediátrica/Fibrose Cística", count: 22 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Mononucleose Infecciosa", count: 4 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Síndrome Mão-Pé-Boca", count: 1 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Sarampo", count: 14 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Exantema Súbito", count: 3 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Eritema Infeccioso", count: 5 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Doenças Exantemáticas/Varicela", count: 9 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Febre Sem Sinais Localizatórios", count: 9 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Infecções das Vias Aéreas/Infecções do Trato Respiratório Superior", count: 36 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Infecções das Vias Aéreas/Infecções do Trato Respiratório Inferior/Pneumonias", count: 48 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Infecções das Vias Aéreas/Infecções do Trato Respiratório Inferior/Bronquiolite Viral Aguda", count: 27 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Infectologia Pediátrica/Infecções das Vias Aéreas/Infecções do Trato Respiratório Inferior/Coqueluche", count: 21 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Gastroenterologia Pediátrica/Diarreia/Diarreia Aguda na Infância", count: 54 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Gastroenterologia Pediátrica/Outras Doenças da Gastropediatria/Constipação", count: 22 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Gastroenterologia Pediátrica/Outras Doenças da Gastropediatria/Alergias Alimentares", count: 13 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Gastroenterologia Pediátrica/Outras Doenças da Gastropediatria/Refluxo Gastroesofágico na Infância/Doença do Refluxo Gastroesofágico", count: 7 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Nefrologia Pediátrica/Infecção de Trato Urinário na Infância", count: 23 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neurologia Pediátrica/Meningoencefalites na Infância/Meningite Viral", count: 32 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neurologia Pediátrica/Meningoencefalites na Infância/Meningite Bacteriana", count: 1 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Neurologia Pediátrica/Transtornos Convulsivos na Infância", count: 9 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Reumatologia Pediátrica/Doença de Kawasaki", count: 23 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Reumatologia Pediátrica/Púrpura de Henoch-Schonlein", count: 13 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Reumatologia Pediátrica/Artrite Idopática Juvenil", count: 16 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Reumatologia Pediátrica/Febre Reumática", count: 19 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Hipotireoidismo Congênito", count: 6 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Desordens do Desenvolvimento Sexual", count: 9 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Hiperplasia Adrenal Congênita", count: 13 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Puberdade/Puberdade Normal", count: 20 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Puberdade/Puberdade Anormal/Puberdade Precoce", count: 23 },
        { path: "PEDIATRIA/Especialidades Pediátricas/Endocrinologia Pediátrica/Puberdade/Puberdade Anormal/Atraso Puberal", count: 11 },
        { path: "PEDIATRIA/Emergências Pediátricas/Parada Cardiorrespiratória", count: 34 },
        { path: "PEDIATRIA/Emergências Pediátricas/Arritmias", count: 9 },
        { path: "PEDIATRIA/Emergências Pediátricas/Choque", count: 29 },
        { path: "PEDIATRIA/Emergências Pediátricas/Anafilaxia e Urticária", count: 23 },
        { path: "PEDIATRIA/Emergências Pediátricas/OVACE e Ingestão de Corpo Estranho", count: 22 },
        { path: "PEDIATRIA/Emergências Pediátricas/BRUE e Síndrome da Morte Súbita do Lactente", count: 15 },
        { path: "PEDIATRIA/Violência contra a Criança", count: 15 },
        { path: "PEDIATRIA/Hebiatria", count: 10 },
        { path: "PEDIATRIA/Puericultura/Vacinas e Imunizações", count: 87 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Aleitamento Materno", count: 77 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Introdução Alimentar", count: 7 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Suplementação Vitamínica e Sais Minerais/Ferro", count: 8 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Suplementação Vitamínica e Sais Minerais/Vitamina D", count: 3 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Distúrbios Nutricionais/Obesidade", count: 8 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Distúrbios Nutricionais/Desnutrição", count: 14 },
        { path: "PEDIATRIA/Puericultura/Aleitamento Materno e Nutrição Infantil/Introdução Alimentar, Suplementação e Distúrbios Nutricionais/Distúrbios Nutricionais/Hipovitaminoses", count: 11 },
        { path: "PEDIATRIA/Puericultura/Crescimento e Desenvolvimento Neuropsicomotor/Crescimento", count: 45 },
        { path: "PEDIATRIA/Puericultura/Crescimento e Desenvolvimento Neuropsicomotor/Desenvolvimento Neuropsicomotor/Desenvolvimento Neuropsicomotor Normal", count: 30 },
        { path: "PEDIATRIA/Puericultura/Puericultura Geral", count: 34 },
        { path: "OUTROS/Ortopedia/Ortopedia Pediátrica", count: 25 },
        ].map(deck => ({
        ...deck,
        questionPattern: (i) => `tl_card_${i}_perg.png`,
        answerPattern: (i) => `tl_card_${i}_resp.png`,
        }));

        // Decks para REVISÃO ESPAÇADA (exclusivos)
        const revisaoEspacadaDecks = [
             {
                path: "CIRURGIA GERAL/Trauma/Choque Hemorrágico",
                count: 8,
                questionPattern: (i) => `re_card_${i}_perg.png`,
                answerPattern: (i) => `re_card_${i}_resp.png`,
            },
            {
                path: "CIRURGIA GERAL/Abdome Agudo/Abdome Agudo Inflamatório/Diverticulite Aguda",
                count: 5,
                questionPattern: (i) => `re_card_${i}_perg.png`,
                answerPattern: (i) => `re_card_${i}_resp.png`,
            },
            {
                path: "CLÍNICA MÉDICA/Nefrologia/Glomerulopatias",
                count: 12,
                questionPattern: (i) => `re_card_${i}_perg.png`,
                answerPattern: (i) => `re_card_${i}_resp.png`,
            },
            {
                path: "Pediatria",
                count: 1,
                questionPattern: (i) => `card_${i}_ped_perg.png`,
                answerPattern: (i) => `card_${i}_ped_resp.png`,
            },
            {
                path: "Pediatria/Puericultura",
                count: 17,
                questionPattern: (i) => `card_${i}_ped_puericultura_perg.png`,
                answerPattern: (i) => `card_${i}_ped_puericultura_resp.png`,
            }

        ];

        // Combina para a contagem total no dashboard global (Métricas)
        const allFlashcardDecks = [...treinoLivreDecks, ...revisaoEspacadaDecks];
        // --- FIM DA ÁREA DE CONFIGURAÇÃO ---


        document.addEventListener('DOMContentLoaded', function () {

            // --- Seletores de Elementos ---
            let currentStudyMode = 'treinoLivre'; // 'treinoLivre' ou 'revisaoEspacada'
            const dashboardView = document.getElementById('dashboardView');
            const studyView = document.getElementById('studyView');
            const learningModeModal = document.getElementById('learningModeModal');
            const openLearningModeBtn = document.getElementById('openLearningModeBtn');
            const closeLearningModeBtn = document.getElementById('closeLearningModeBtn');
            const openFiltersBtn = document.getElementById('openFiltersBtn');
            const treinoLivreView = document.getElementById('treinoLivreView');
            const revisaoEspacadaView = document.getElementById('revisaoEspacadaView');
            const selectTreinoLivre = document.getElementById('selectTreinoLivre');
            const selectRevisaoEspacada = document.getElementById('selectRevisaoEspacada');
            const learningModeBtnSpan = openLearningModeBtn.querySelector('span');
            const startStudyBtn = document.getElementById('startStudyBtn');
            const startReviewBtn = document.getElementById('startReviewBtn');
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');
            const calendarContainer = document.getElementById('calendar');
            const instructionsModal = document.getElementById('instructionsModal');
            const instructionsBtn = document.getElementById('instructionsBtn');
            const closeInstructionsBtn = document.getElementById('closeInstructionsBtn');
            const mapOverlay = document.getElementById('map-overlay');
            const mapPanel = document.getElementById('map-panel');
            const mapBtn = document.getElementById('mapBtn');
            const closeMapBtn = document.getElementById('closeMapBtn');
            const mapPanelContent = document.getElementById('map-panel-content');
            const mapPageIndicator = document.getElementById('map-page-indicator');
            const mapPrevBtn = document.getElementById('map-prev-btn');
            const mapNextBtn = document.getElementById('map-next-btn');
            const calendarMonthYearSelect = document.getElementById('calendar-month-year-select');

            // --- Seletores para Filtros ---
            const filtersModal = document.getElementById('filtersModal');
            const closeFiltersModalBtn = document.getElementById('closeFiltersModalBtn');
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            const subjectListContainer = document.getElementById('subjectListContainer');
            const selectAllBtn = document.getElementById('selectAllBtn');
            const unselectAllBtn = document.getElementById('unselectAllBtn');
            const statsToggle = document.getElementById('statsToggle');
            const filterSearchInput = document.getElementById('filterSearchInput');
            const excludeVistos = document.getElementById('excludeVistos');
            const excludeDominados = document.getElementById('excludeDominados');
            const difficultyFilters = document.getElementById('difficultyFilters');
            const resetFiltersBtn = document.getElementById('resetFiltersBtn');
            
            // --- Seletores para Filtros de Revisão ---
            const revisaoFiltersModal = document.getElementById('revisaoFiltersModal');
            const closeRevisaoFiltersModalBtn = document.getElementById('closeRevisaoFiltersModalBtn');
            const applyRevisaoFiltersBtn = document.getElementById('applyRevisaoFiltersBtn');
            const revisaoSubjectListContainer = document.getElementById('revisaoSubjectListContainer');
            const revisaoFilterSearchInput = document.getElementById('revisaoFilterSearchInput');
            const resetRevisaoFiltersBtn = document.getElementById('resetRevisaoFiltersBtn');
            
            // --- Seletores do novo cabeçalho ---
            const mainMenuBtn = document.getElementById('mainMenuBtn');
            const mainMenuPanel = document.getElementById('mainMenuPanel');
            const mainMenuOverlay = document.getElementById('mainMenuOverlay');
            const closeMainMenuBtn = document.getElementById('closeMainMenuBtn');
            const notificationsBtn = document.getElementById('notificationsBtn');
            const notificationsDropdown = document.getElementById('notificationsDropdown');
            const closeNotificationsBtn = document.getElementById('closeNotificationsBtn');
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenuDropdown = document.getElementById('userMenuDropdown');
            const searchBtn = document.getElementById('searchBtn');
            const searchInputWrapper = document.getElementById('searchInputWrapper');
            const searchInput = document.getElementById('searchInput');
            const closeSearchBtn = document.getElementById('closeSearchBtn');
            const searchContainer = document.getElementById('searchContainer');
            const header = document.querySelector('header');


            // --- Estado dos Filtros ---
            let activeDifficultyFilter = 'all';

            // --- Lógica Geral de UI (Modais, Troca de Views) ---
            const openModal = (modal) => modal.classList.remove('hidden');
            const closeModal = (modal) => modal.classList.add('hidden');

            openLearningModeBtn.addEventListener('click', () => openModal(learningModeModal));
            closeLearningModeBtn.addEventListener('click', () => closeModal(learningModeModal));
            learningModeModal.addEventListener('click', (event) => { if (event.target === learningModeModal) closeModal(learningModeModal); });
            
            openFiltersBtn.addEventListener('click', () => {
                if (currentStudyMode === 'treinoLivre') {
                    updateStatsVisibility();
                    openModal(filtersModal);
                } else {
                    openModal(revisaoFiltersModal);
                }
            });
            
            // Listeners para fechar modais de filtro
            closeFiltersModalBtn.addEventListener('click', () => closeModal(filtersModal));
            closeRevisaoFiltersModalBtn.addEventListener('click', () => closeModal(revisaoFiltersModal));

            applyFiltersBtn.addEventListener('click', () => {
                updateTreinoLivreStats();
                closeModal(filtersModal);
            });
            
            applyRevisaoFiltersBtn.addEventListener('click', () => {
                // Lógica para aplicar filtros de revisão
                updateRevisaoEspacadaStats();
                updateFlashcardCount();
                closeModal(revisaoFiltersModal);
            });

            backToDashboardBtn.addEventListener('click', () => {
                studyView.classList.add('hidden');
                dashboardView.classList.remove('hidden');
                header.classList.remove('hidden');
                updateAllDashboardStats();
            });
            
            [startStudyBtn, startReviewBtn].forEach(btn => {
                btn.addEventListener('click', () => {
                    const flashcards = getFilteredFlashcards();
                    
                    if (flashcards.length > 0) {
                        initializeFlashcardViewer(flashcards);
                        dashboardView.classList.add('hidden');
                        studyView.classList.remove('hidden');
                        header.classList.add('hidden');
                    } else {
                        // Substituindo alert() por uma mensagem no console
                        console.log("Nenhum flashcard encontrado para os filtros selecionados.");
                        // Em uma aplicação real, você usaria um modal customizado
                    }
                });
            });

            function switchStudyMode(mode) {
                currentStudyMode = mode;
                if (mode === 'treinoLivre') {
                    treinoLivreView.classList.remove('hidden');
                    revisaoEspacadaView.classList.add('hidden');
                    document.getElementById('sharedMetricsContainer').classList.remove('hidden');
                    learningModeBtnSpan.textContent = 'Modo de estudo: Treino Livre';
                    updateSelectionUI(selectTreinoLivre, selectRevisaoEspacada);
                    // Garante que as estatísticas do Treino Livre sejam carregadas no dashboard principal
                    updateTreinoLivreStats();
                } else {
                    treinoLivreView.classList.add('hidden');
                    revisaoEspacadaView.classList.remove('hidden');
                    document.getElementById('sharedMetricsContainer').classList.remove('hidden');
                    learningModeBtnSpan.textContent = 'Modo de estudo: Revisão Espaçada';
                    updateSelectionUI(selectRevisaoEspacada, selectTreinoLivre);
                    // Garante que as estatísticas da Revisão Espaçada sejam carregadas no dashboard principal
                    updateRevisaoEspacadaStats();
                }
                updateAllDashboardStats(); // Atualiza métricas globais (agora com filtro de modo)
                updateFlashcardCount(); // Atualiza a contagem do botão ao trocar de modo
            }

            selectTreinoLivre.addEventListener('click', () => {
                switchStudyMode('treinoLivre');
                closeModal(learningModeModal);
            });
            selectRevisaoEspacada.addEventListener('click', () => {
                switchStudyMode('revisaoEspacada');
                closeModal(learningModeModal);
            });

            function updateSelectionUI(selected, deselected) {
                 // Remove o estilo da borda/fundo dos dois elementos
                 [selected, deselected].forEach(el => {
                    el.classList.remove('border-2', 'border-[#D98E73]', 'bg-[#D98E73]', 'bg-opacity-5');
                    el.classList.add('border', 'border-gray-700');
                    const indicator = el.querySelector('.selection-indicator');
                    indicator.innerHTML = '';
                    indicator.classList.remove('bg-[#D98E73]', 'border-[#D98E73]');
                    indicator.classList.add('border-gray-500');
                 });

                 // Adiciona o estilo de seleção ao elemento selecionado
                 selected.classList.add('border-2', 'border-[#D98E73]', 'bg-[#D98E73]', 'bg-opacity-5');
                 const selectedIndicator = selected.querySelector('.selection-indicator');
                 selectedIndicator.classList.add('bg-[#D98E73]', 'border-[#D98E73]');
                 selectedIndicator.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-black"></i>`;
                 lucide.createIcons();
            }
            
            // --- Lógica do Novo Cabeçalho ---
            mainMenuBtn.addEventListener('click', () => {
                mainMenuOverlay.classList.remove('hidden');
                mainMenuPanel.classList.add('open');
            });
            const closeMainMenu = () => {
                mainMenuPanel.classList.remove('open');
                mainMenuOverlay.classList.add('hidden');
            }
            closeMainMenuBtn.addEventListener('click', closeMainMenu);
            mainMenuOverlay.addEventListener('click', closeMainMenu);

            notificationsBtn.addEventListener('click', () => notificationsDropdown.classList.toggle('hidden'));
            closeNotificationsBtn.addEventListener('click', () => notificationsDropdown.classList.add('hidden'));

            userMenuBtn.addEventListener('click', () => userMenuDropdown.classList.toggle('hidden'));
            
            searchBtn.addEventListener('click', () => {
                searchInputWrapper.classList.add('w-64');
                searchInput.classList.remove('opacity-0');
                closeSearchBtn.classList.remove('opacity-0');
                searchBtn.classList.add('opacity-0');
                searchInput.focus();
            });

            closeSearchBtn.addEventListener('click', () => {
                searchInputWrapper.classList.remove('w-64');
                searchInput.classList.add('opacity-0');
                closeSearchBtn.classList.add('opacity-0');
                searchBtn.classList.remove('opacity-0');
                searchInput.value = '';
                document.getElementById('searchResults').classList.add('hidden');
            });

            // Fecha dropdowns se clicar fora
            window.addEventListener('click', (e) => {
                // Garante que o menu principal feche
                if (!mainMenuPanel.contains(e.target) && !mainMenuBtn.contains(e.target) && mainMenuPanel.classList.contains('open')) {
                    closeMainMenu();
                }
                
                // Fecha Notificações e Menu do Usuário
                if (!notificationsBtn.parentElement.contains(e.target)) {
                    notificationsDropdown.classList.add('hidden');
                }
                if (!userMenuBtn.parentElement.contains(e.target)) {
                    userMenuDropdown.classList.add('hidden');
                }
            });


            // --- Lógica do Modal de Instruções & Mapa ---
            instructionsBtn.addEventListener('click', () => openModal(instructionsModal));
            closeInstructionsBtn.addEventListener('click', () => closeModal(instructionsModal));

            const openMap = () => {
                mapCurrentPage = 1;
                populateFlashcardMap();
                mapOverlay.classList.remove('hidden');
                mapPanel.classList.remove('translate-x-full');
            };
            const closeMap = () => {
                mapOverlay.classList.add('hidden');
                mapPanel.classList.add('translate-x-full');
            };
            mapBtn.addEventListener('click', openMap);
            closeMapBtn.addEventListener('click', closeMap);
            mapOverlay.addEventListener('click', closeMap);

            
            // --- Lógica do Modal de Filtros (Hierarquia) ---
            function createSubjectItem(item, level, path = '') {
                const hasChildren = item.children && item.children.length > 0;
                const displayName = typeof item === 'string' ? item : item.name;
                const currentPath = path ? `${path}/${displayName}` : displayName;
                
                const itemWrapper = document.createElement('div');
                itemWrapper.className = 'subject-item';
                itemWrapper.dataset.path = currentPath;
                itemWrapper.dataset.isLeaf = !hasChildren;

                const itemHtml = `
                    <div class="py-2">
                        <div style="padding-left: ${level * 24}px;">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" class="w-4 h-4 bg-gray-700 border-gray-600 rounded flex-shrink-0">
                                <div class="flex-grow flex items-center justify-between cursor-pointer item-content">
                                    <p class="text-sm flex-grow">${displayName}</p>
                                    <span class="text-xs text-gray-500 px-2 mr-2 simple-stats"></span>
                                    ${hasChildren ? '<i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transition-transform mr-2"></i>' : '<div class="w-5 h-5 mr-2"></div>'}
                                </div>
                            </div>
                            <div class="detailed-stats hidden text-xs text-gray-400" style="padding-left: 28px;"></div>
                        </div>
                    </div>
                    ${hasChildren ? `<div class="subject-children hidden"></div>` : ''}
                `;
                itemWrapper.innerHTML = itemHtml;
                
                if (hasChildren) {
                    const childrenContainer = itemWrapper.querySelector('.subject-children');
                    // Recursivamente cria os filhos
                    (item.children || []).forEach(child => {
                        childrenContainer.appendChild(createSubjectItem(child, level + 1, currentPath));
                    });
                    
                     // Listener para expandir/colapsar
                     const contentDiv = itemWrapper.querySelector('.item-content');
                     if (contentDiv) {
                         contentDiv.addEventListener('click', (e) => {
                            if (e.target.closest('input')) return;
                            childrenContainer.classList.toggle('hidden');
                            const icon = itemWrapper.querySelector('[data-lucide="chevron-down"]');
                            if (icon) icon.classList.toggle('rotate-180');
                        });
                     }
                }
                
                const checkbox = itemWrapper.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.addEventListener('change', (e) => {
                        // Propaga o estado para os filhos
                        itemWrapper.querySelectorAll('.subject-children input[type="checkbox"]').forEach(childCb => {
                            childCb.checked = e.target.checked;
                            childCb.indeterminate = false;
                        });
                        // Atualiza os pais
                        updateParentCheckboxes(itemWrapper);
                        updateFlashcardCount();
                    });
                }
                
                return itemWrapper;
            }

            function updateParentCheckboxes(element) {
                const parentWrapper = element.parentElement.closest('.subject-item');
                if (!parentWrapper) return;

                const parentCheckbox = parentWrapper.querySelector(':scope > .py-2 input[type="checkbox"]');
                const childrenContainer = parentWrapper.querySelector(':scope > .subject-children');

                if (!childrenContainer || !parentCheckbox) return;

                // Filtra para pegar apenas os checkboxes dos filhos diretos
                const directChildrenCheckboxes = Array.from(childrenContainer.children)
                    .map(childItem => childItem.querySelector(':scope > .py-2 input[type="checkbox"]'))
                    .filter(cb => cb); 

                if (directChildrenCheckboxes.length === 0) return;

                const allChecked = directChildrenCheckboxes.every(cb => cb.checked && !cb.indeterminate);
                const someChecked = directChildrenCheckboxes.some(cb => cb.checked || cb.indeterminate);

                parentCheckbox.checked = allChecked;
                parentCheckbox.indeterminate = !allChecked && someChecked;

                updateParentCheckboxes(parentWrapper);
            }

            // Geração da lista hierárquica inicial
            subjectsData.forEach(item => subjectListContainer.appendChild(createSubjectItem(item, 0)));
            
            function getSelectedFilterPaths() {
                const paths = [];
                // Pega apenas os caminhos dos nós folha selecionados (os mais específicos)
                subjectListContainer.querySelectorAll('.subject-item[data-is-leaf="true"]').forEach(item => {
                    const checkbox = item.querySelector(':scope > .py-2 input[type="checkbox"]');
                    if(checkbox && checkbox.checked) {
                        paths.push(item.dataset.path);
                    }
                });
                return paths;
            }
            
            function updateFlashcardCount() {
                const flashcards = getFilteredFlashcards();
                const count = flashcards.length;
                
                // Atualiza contagem nos modais e botões de início
                if (currentStudyMode === 'treinoLivre') {
                    applyFiltersBtn.textContent = `Aplicar filtros (${count} flashcards)`;
                    startStudyBtn.textContent = `Iniciar Treino Livre (${count})`;
                } else {
                    applyRevisaoFiltersBtn.textContent = `Aplicar filtros (${count} flashcards)`;
                    startReviewBtn.textContent = `Revisar agora (${count})`;
                }
            }

            // --- Lógica de Geração de Flashcards ---
            function getDeckList(mode) {
                return mode === 'treinoLivre' ? treinoLivreDecks : revisaoEspacadaDecks;
            }

            function generateFlashcardList(selectedPaths) {
                const decks = getDeckList(currentStudyMode);
                const generatedFlashcards = new Set();
                selectedPaths.forEach(selectedPath => {
                    decks.forEach(deck => {
                        // Verifica se o deck começa com o caminho selecionado
                        if (deck.path.startsWith(selectedPath)) {
                            for (let i = 1; i <= deck.count; i++) {
                                // Garante IDs únicos e distintos entre os modos (tl_ ou re_)
                                const prefix = currentStudyMode === 'treinoLivre' ? 'tl' : 're';
                                const card = {
                                    id: `${prefix}_${deck.path}-${i}`,
                                    path: deck.path, // Adiciona o path para referência
                                    front: `./${deck.path}/${deck.questionPattern(i)}`,
                                    back: `./${deck.path}/${deck.answerPattern(i)}`,
                                };
                                generatedFlashcards.add(JSON.stringify(card));
                            }
                        }
                    });
                });
                return Array.from(generatedFlashcards).map(cardStr => JSON.parse(cardStr));
            }

            function generateRevisaoFlashcardList(selectedSubjects) {
                // Esta função é chamada SOMENTE no modo 'revisaoEspacada', então usa revisaoEspacadaDecks
                const decks = revisaoEspacadaDecks;
                const cardsToReview = [];
                const subjectsToGet = selectedSubjects.length > 0 ? selectedSubjects : subjectsDataRevisao;

                // Esta lógica SIMULA um filtro de revisão. Na realidade, usaria o algoritmo SM-2.
                const reviews = loadReviews('revisaoEspacada'); // Busca reviews apenas da REVISAO ESPAÇADA
                
                decks.forEach(deck => {
                    // Verifica se o deck contém algum dos assuntos selecionados
                    const isRevisionDeck = subjectsToGet.some(subject => deck.path.includes(subject));
                    
                    if (isRevisionDeck) {
                        for (let i = 1; i <= deck.count; i++) {
                            const cardId = `re_${deck.path}-${i}`; // ID com prefixo 're_'
                            const cardReviews = reviews[cardId] || [];
                            
                            // Lógica de agendamento SM-2 simplificada (apenas para demonstração)
                            // Apenas adiciona cards que não foram revisados ou foram classificados como "Errei" (1)
                            if (cardReviews.length === 0 || cardReviews[cardReviews.length - 1].rating <= 2) {
                                const card = {
                                    id: cardId,
                                    path: deck.path,
                                    front: `./${deck.path}/${deck.questionPattern(i)}`,
                                    back: `./${deck.path}/${deck.answerPattern(i)}`,
                                };
                                cardsToReview.push(card);
                            }
                        }
                    }
                });
                return cardsToReview;
            }


            // --- Lógica do Visualizador de Flashcards ---
            let flashcardList = [];
            let currentCardIndex = 0;
            let isRevealed = false;
            let mapCurrentPage = 1;
            const MAP_CARDS_PER_PAGE = 20;
            // Variáveis globais para rastreamento de tempo (para Sequência e Tempo Estudado)
            let sessionStartTime = null; 

            const UNIVERSAL_FRONT_BG = 'https://placehold.co/1080x1450/2D2D2D/FFFFFF?text=Frente+do+Card';
            const UNIVERSAL_BACK_BG = 'https://placehold.co/1080x1450/2D2D2D/FFFFFF?text=Verso+do+Card';

            const cardArea = document.getElementById('card-area');
            const flashcardFrontContainer = document.getElementById('flashcard-front-container');
            const flashcardBackContainer = document.getElementById('flashcard-back-container');
            const frontBgImg = document.getElementById('flashcard-front-bg-img');
            const frontFgImg = document.getElementById('flashcard-front-fg-img');
            const backBgImg = document.getElementById('flashcard-back-bg-img');
            const backFgImg = document.getElementById('flashcard-back-fg-img');
            const revealButton = document.getElementById('reveal-button');
            const ratingSection = document.getElementById('rating-section');
            const revealSection = document.getElementById('reveal-section');
            const prevBtn = document.getElementById('prev-card-btn');
            const nextBtn = document.getElementById('next-card-btn');
            const progressText = document.getElementById('study-progress-text');
            const progressFill = document.getElementById('study-progress-fill');
            const studyModeTitle = document.getElementById('studyModeTitle');

            function initializeFlashcardViewer(cards) {
                flashcardList = cards;
                currentCardIndex = 0;
                mapCurrentPage = 1;
                sessionStartTime = Date.now(); // Inicia a contagem do tempo de sessão
                studyModeTitle.textContent = currentStudyMode === 'treinoLivre' ? 'Treino Livre em Andamento' : 'Revisão Espaçada de Cards para Hoje';
                showCard();
                populateFlashcardMap();
            }

            function updateProgress() {
                const currentNumber = currentCardIndex + 1;
                const total = flashcardList.length;
                progressText.textContent = `${currentNumber}/${total}`;
                progressFill.style.width = total > 0 ? `${(currentNumber / total) * 100}%` : '0%';
            }

            function showCard() {
                if (flashcardList.length === 0) {
                     progressText.textContent = `0/0`;
                     progressFill.style.width = '0%';
                     frontFgImg.src = 'https://placehold.co/1080x1450/191C1F/3E454D?text=Nenhum+card+encontrado';
                    return;
                };
                isRevealed = false;
                const card = flashcardList[currentCardIndex];
                
                // Configura as imagens (URLs de placeholder ou imagens mockadas)
                frontBgImg.src = UNIVERSAL_FRONT_BG;
                frontFgImg.src = card.front;
                backBgImg.src = UNIVERSAL_BACK_BG;
                backFgImg.src = card.back;
                
                // Remove as classes de rating e esconde o verso
                flashcardFrontContainer.classList.remove('border-rating-1', 'border-rating-2', 'border-rating-3', 'border-rating-4');
                flashcardBackContainer.classList.add('hidden');
                flashcardBackContainer.classList.remove('border-rating-1', 'border-rating-2', 'border-rating-3', 'border-rating-4');
                
                // Redimensiona o card para mostrar apenas a frente
                cardArea.classList.remove('max-w-4xl');
                cardArea.classList.add('max-w-sm');
                
                ratingSection.classList.add('hidden');
                revealSection.classList.remove('hidden');
                updateProgress();
                prevBtn.disabled = currentCardIndex === 0;
                nextBtn.disabled = currentCardIndex === flashcardList.length - 1;
            }

            function revealAnswer() {
                if (isRevealed || flashcardList.length === 0) return;
                isRevealed = true;
                cardArea.classList.remove('max-w-sm');
                cardArea.classList.add('max-w-4xl');
                flashcardBackContainer.classList.remove('hidden');
                revealSection.classList.add('hidden');
                ratingSection.classList.remove('hidden');
            }
            
            function navigate(direction) {
                const newIndex = currentCardIndex + direction;
                if (newIndex >= 0 && newIndex < flashcardList.length) {
                    currentCardIndex = newIndex;
                    showCard();
                } else if (newIndex >= flashcardList.length) {
                    // Substituindo alert() por console.log e voltando ao dashboard
                    console.log('Fim da sessão de estudos!');
                    backToDashboardBtn.click();
                }
            }
            
            // Adiciona atalhos de teclado
            document.addEventListener('keydown', (e) => {
                if (studyView.classList.contains('hidden')) return; // Só funciona na tela de estudo
                
                if (e.key === ' ' || e.key === 'Enter') {
                    e.preventDefault();
                    if (!isRevealed) {
                        revealAnswer();
                    }
                } else if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    navigate(-1);
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    if (isRevealed) {
                        // Se revelado, simula o clique no botão de rating 'Fácil' (4) para avançar
                        const ratingButton = document.querySelector('.study-rating-button[data-rating="4"]');
                        if (ratingButton) ratingButton.click();
                    } else {
                        navigate(1);
                    }
                } else if (isRevealed && ['1', '2', '3', '4'].includes(e.key)) {
                    e.preventDefault();
                    const ratingButton = document.querySelector(`.study-rating-button[data-rating="${e.key}"]`);
                    if (ratingButton) ratingButton.click();
                }
            });

            revealButton.addEventListener('click', revealAnswer);
            prevBtn.addEventListener('click', () => navigate(-1));
            nextBtn.addEventListener('click', () => navigate(1));

            ratingSection.querySelectorAll('.study-rating-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const rating = parseInt(e.currentTarget.dataset.rating);
                    const currentCard = flashcardList[currentCardIndex];
                    
                    const ratingClass = `border-rating-${rating}`;
                    flashcardFrontContainer.classList.add(ratingClass);
                    flashcardBackContainer.classList.add(ratingClass);

                    saveReview(currentCard.id, rating);
                    
                    // Adiciona o tempo de sessão ao tempo estudado do dia
                    if (sessionStartTime) {
                        const sessionEndTime = Date.now();
                        const duration = sessionEndTime - sessionStartTime;
                        saveStudyTime(currentStudyMode, duration); // Atualizado para usar o modo
                        sessionStartTime = sessionEndTime; // Reinicia a contagem para o próximo card (simulação)
                    }

                    setTimeout(() => navigate(1), 400); 
                });
            });

            // --- Lógica do Mapa de Flashcards ---
            function populateFlashcardMap() {
                mapPanelContent.innerHTML = '';
                 mapPanelContent.className = 'flex-grow p-4 overflow-y-auto space-y-3'; // Assegura o espaçamento
                const totalPages = Math.ceil(flashcardList.length / MAP_CARDS_PER_PAGE);
                mapPageIndicator.textContent = `Página ${mapCurrentPage} de ${totalPages}`;
                
                const startIndex = (mapCurrentPage - 1) * MAP_CARDS_PER_PAGE;
                const endIndex = startIndex + MAP_CARDS_PER_PAGE;
                const pageCards = flashcardList.slice(startIndex, endIndex);

                const reviews = loadReviews();
                const ratingMap = {
                    1: { text: 'Errei', color: 'text-purple-400 bg-purple-900/50' },
                    2: { text: 'Difícil', color: 'text-orange-400 bg-orange-900/50' },
                    3: { text: 'Médio', color: 'text-yellow-400 bg-yellow-900/50' },
                    4: { text: 'Fácil', color: 'text-green-400 bg-green-900/50' }
                };

                pageCards.forEach((card, index) => {
                    const cardIndex = startIndex + index;
                    const cardReviews = reviews[card.id];
                    let ratingTagHtml = '<div class="absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-semibold text-[#727980] bg-[#2a2f35]">Não votado</div>';

                    if (cardReviews && cardReviews.length > 0) {
                        const lastReview = cardReviews[cardReviews.length - 1];
                        const ratingInfo = ratingMap[lastReview.rating];
                        if (ratingInfo) {
                            ratingTagHtml = `<div class="absolute top-2 right-2 px-2 py-1 rounded-full text-xs font-semibold ${ratingInfo.color}">${ratingInfo.text}</div>`;
                        }
                    }

                    const cardElement = document.createElement('div');
                    cardElement.className = 'bg-[#191C1F] rounded-lg p-4 border-2 transition-colors cursor-pointer relative';
                    cardElement.style.borderColor = cardIndex === currentCardIndex ? '#D98E73' : '#2a2f35'; // Destaca o card atual
                    cardElement.dataset.index = cardIndex;

                    cardElement.innerHTML = `
                        ${ratingTagHtml}
                        <div class="flex items-start gap-3">
                            <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white" style="background-color: #C48462;">
                                ${cardIndex + 1}
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex gap-2">
                                    <div class="flex-1">
                                        <!-- Note: Os caminhos de imagem são simulados e não carregam imagens reais aqui -->
                                        <img src="${card.front}" alt="Frente - Flashcard ${cardIndex + 1}" class="w-full object-cover rounded-lg border border-[#2a2f35] aspect-[500/672]" onerror="handleImageError(this)">
                                        <p class="text-xs text-[#727980] text-center mt-1">Frente</p>
                                    </div>
                                    <div class="flex-1">
                                        <!-- Note: Os caminhos de imagem são simulados e não carregam imagens reais aqui -->
                                        <img src="${card.back}" alt="Verso - Flashcard ${cardIndex + 1}" class="w-full object-cover rounded-lg border border-[#2a2f35] aspect-[500/672]" onerror="handleImageError(this)">
                                        <p class="text-xs text-[#727980] text-center mt-1">Verso</p>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2 truncate">${card.path}</p>
                            </div>
                        </div>
                    `;

                    cardElement.addEventListener('mouseover', () => { cardElement.style.borderColor = '#C48462'; });
                    cardElement.addEventListener('mouseout', () => { 
                         cardElement.style.borderColor = cardIndex === currentCardIndex ? '#D98E73' : '#2a2f35'; 
                    });
                    
                    cardElement.addEventListener('click', () => {
                        currentCardIndex = cardIndex;
                        showCard();
                        closeMap();
                    });
                    mapPanelContent.appendChild(cardElement);
                });

                mapPrevBtn.disabled = mapCurrentPage === 1;
                mapNextBtn.disabled = mapCurrentPage === totalPages;
            }

            mapPrevBtn.addEventListener('click', () => {
                if (mapCurrentPage > 1) {
                    mapCurrentPage--;
                    populateFlashcardMap();
                }
            });
            mapNextBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(flashcardList.length / MAP_CARDS_PER_PAGE);
                if (mapCurrentPage < totalPages) {
                    mapCurrentPage++;
                    populateFlashcardMap();
                }
            });


            // --- Lógica de Armazenamento e Estatísticas (usando localStorage) ---
            function saveReview(cardId, rating) {
                const key = currentStudyMode === 'treinoLivre' ? TREINO_LIVRE_REVIEWS_KEY : REVISAO_ESPACADA_REVIEWS_KEY;
                const reviews = JSON.parse(localStorage.getItem(key) || '{}');
                if (!reviews[cardId]) {
                    reviews[cardId] = [];
                }
                const today = new Date().toISOString().split('T')[0];
                reviews[cardId].push({ rating, date: today });
                localStorage.setItem(key, JSON.stringify(reviews));
                
                // Atualiza as estatísticas após cada review
                updateAllDashboardStats();
                if(currentStudyMode === 'treinoLivre') {
                    updateTreinoLivreStats();
                } else {
                    updateRevisaoEspacadaStats();
                }
            }

            // Novo: Salva o tempo de estudo
            const STUDY_TIME_KEY = 'dailyStudyTime';

            function saveStudyTime(mode, durationMs) {
                const key = mode === 'treinoLivre' ? STUDY_TIME_KEY_TREINO : STUDY_TIME_KEY_REVISAO;
                const today = new Date().toISOString().split('T')[0];
                const dailyTimes = JSON.parse(localStorage.getItem(key) || '{}');
                
                dailyTimes[today] = (dailyTimes[today] || 0) + durationMs;
                localStorage.setItem(key, JSON.stringify(dailyTimes));
                
                if (mode === 'revisaoEspacada') {
                    updateRevisaoEspacadaStats(); // Atualiza o tempo na UI imediatamente
                }
            }
            
            function loadReviews(mode) {
                // Se for chamado sem modo, usa o modo ativo atual
                const actualMode = mode || currentStudyMode;
                const key = actualMode === 'treinoLivre' ? TREINO_LIVRE_REVIEWS_KEY : REVISAO_ESPACADA_REVIEWS_KEY;
                return JSON.parse(localStorage.getItem(key) || '{}');
            }
            
            function loadAllReviews(mode = null) {
                // Carrega reviews de AMBOS os modos para o contexto global
                if (mode === 'treinoLivre') return loadReviews('treinoLivre');
                if (mode === 'revisaoEspacada') return loadReviews('revisaoEspacada');
                
                // Se nenhum modo for especificado (contexto de dashboard global, que foi o ponto de correção)
                // Retorna apenas reviews do MODO ATIVO, separando as métricas.
                return loadReviews(currentStudyMode);
            }

            function loadDailyStudyTimes(mode = null) {
                const actualMode = mode || currentStudyMode;
                const times = {};
                
                if (actualMode === 'treinoLivre') {
                    return JSON.parse(localStorage.getItem(STUDY_TIME_KEY_TREINO) || '{}');
                }
                if (actualMode === 'revisaoEspacada') {
                     return JSON.parse(localStorage.getItem(STUDY_TIME_KEY_REVISAO) || '{}');
                }
                
                // Se mode for null, retorna apenas o tempo do modo ativo (para métricas gerais)
                const key = currentStudyMode === 'treinoLivre' ? STUDY_TIME_KEY_TREINO : STUDY_TIME_KEY_REVISAO;
                return JSON.parse(localStorage.getItem(key) || '{}');
            }
            
            function formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                return [hours, minutes, seconds]
                    .map(unit => String(unit).padStart(2, '0'))
                    .join(':');
            }

            function calculateStudyMetrics(mode) {
                // Assegura que usamos o modo correto para buscar as reviews e o tempo
                const reviews = loadReviews(mode); 
                const dailyTimes = loadDailyStudyTimes(mode); 
                const allModeReviewValues = Object.values(reviews).flat();
                
                const today = new Date().toISOString().split('T')[0];
                
                // 1. Tempo Estudado Hoje
                const timeTodayMs = dailyTimes[today] || 0;
                const timeTodayFormatted = formatTime(timeTodayMs);
                
                // 2. Sequência (Streak)
                const studiedDays = new Set(allModeReviewValues.map(r => r.date));
                let streak = 0;
                
                if (studiedDays.size > 0) {
                    let dateToCheck = new Date();
                    const todayStr = today;

                    if (studiedDays.has(todayStr)) {
                        streak = 1;
                        dateToCheck.setDate(dateToCheck.getDate() - 1); 
                    } else {
                        dateToCheck.setDate(dateToCheck.getDate() - 1);
                    }
                    
                    let checking = true;
                    let iterationLimit = 365;
                    
                    while (checking && iterationLimit-- > 0) {
                        const checkDateStr = dateToCheck.toISOString().split('T')[0];
                        
                        if (studiedDays.has(checkDateStr)) {
                            streak++;
                            dateToCheck.setDate(dateToCheck.getDate() - 1);
                        } else {
                            checking = false;
                        }
                    }
                }
                
                return { timeTodayFormatted, streak };
            }

            
            // --- Funções de Atualização de Estatísticas ---
            function updateRevisaoEspacadaStats() {
                // Métrica de Revisão Espaçada (DECK EXCLUSIVO)
                const reviews = loadReviews('revisaoEspacada'); 
                const cardsParaHoje = generateRevisaoFlashcardList([]); // Gerar a lista COMPLETA de cards para hoje, sem filtros de assunto
                const totalParaHoje = cardsParaHoje.length;
                
                // 1. Progresso Hoje e Revisar Hoje (Revisados/Total)
                let revisadosCount = 0;
                cardsParaHoje.forEach(card => {
                    const cardReviews = reviews[card.id] || [];
                    const today = new Date().toISOString().split('T')[0];
                    if (cardReviews.some(review => review.date === today)) {
                        revisadosCount++;
                    }
                });

                const percent = totalParaHoje > 0 ? (revisadosCount / totalParaHoje * 100).toFixed(0) : 0;
                const totalRestante = Math.max(0, totalParaHoje - revisadosCount);

                document.getElementById('todayProgressPercent').textContent = `${percent}%`;
                document.getElementById('todayCardsCount').textContent = `${revisadosCount}/${totalParaHoje}`;
                document.getElementById('startReviewBtn').textContent = `Revisar agora (${totalRestante})`;


                if (window.todayProgressChart) {
                    window.todayProgressChart.data.datasets[0].data = [percent, 100 - percent];
                    window.todayProgressChart.update();
                }

                // 2. Tempo Estudado e Sequência (EXCLUSIVO para Revisão Espaçada)
                const { timeTodayFormatted, streak } = calculateStudyMetrics('revisaoEspacada');
                
                document.getElementById('todayTime').textContent = timeTodayFormatted;
                document.getElementById('todayStreak').textContent = `${streak}d`;
                
                // Re-popula os filtros de revisão com a contagem correta para hoje
                populateRevisaoFilters();
            }

            function updateTreinoLivreStats() {
                const reviews = loadReviews('treinoLivre'); // Carrega reviews do modo Treino Livre
                const selectedPaths = getSelectedFilterPaths();
                const allSelectedCards = generateFlashcardList(selectedPaths);

                const stats = { 1: 0, 2: 0, 3: 0, 4: 0, reviewed: 0 };
                
                allSelectedCards.forEach(card => {
                    const cardReviews = reviews[card.id];
                    if (cardReviews && cardReviews.length > 0) {
                        stats.reviewed++;
                        const lastReview = cardReviews[cardReviews.length - 1];
                        stats[lastReview.rating]++;
                    }
                });
                
                document.getElementById('treinoLivreReviewedCount').textContent = `${stats.reviewed} de ${allSelectedCards.length} Cards com filtros aplicados`;
                const percent = allSelectedCards.length > 0 ? ((stats.reviewed / allSelectedCards.length) * 100).toFixed(0) : 0;
                document.getElementById('treinoLivreReviewedPercent').textContent = `${percent}%`;

                document.getElementById('treinoLivreCountErrei').textContent = stats[1];
                document.getElementById('treinoLivreCountDificil').textContent = stats[2];
                document.getElementById('treinoLivreCountModerado').textContent = stats[3];
                document.getElementById('treinoLivreCountFacil').textContent = stats[4];

                const reviewedCount = stats.reviewed > 0 ? stats.reviewed : 1; // Evita divisão por zero
                document.getElementById('treinoLivreBarErrei').style.width = stats.reviewed > 0 ? `${(stats[1] / reviewedCount) * 100}%` : '0%';
                document.getElementById('treinoLivreBarDificil').style.width = stats.reviewed > 0 ? `${(stats[2] / reviewedCount) * 100}%` : '0%';
                document.getElementById('treinoLivreBarModerado').style.width = stats.reviewed > 0 ? `${(stats[3] / reviewedCount) * 100}%` : '0%';
                document.getElementById('treinoLivreBarFacil').style.width = stats.reviewed > 0 ? `${(stats[4] / reviewedCount) * 100}%` : '0%';
            }


            function updateStatsVisibility() {
                const showStats = statsToggle.checked;
                // Os stats simples e detalhados são para filtros de ASSUNTO, que usam métricas GLOBAIS.
                // Como o utilizador pediu para separar TUDO, vamos usar reviews **globais** para os filtros de assunto,
                // mas baseadas no MODO ATIVO.
                document.querySelectorAll('.simple-stats').forEach(el => el.style.display = showStats ? 'none' : 'inline');
                document.querySelectorAll('.detailed-stats').forEach(el => el.style.display = showStats ? 'none' : 'block');
                if(showStats) {
                    updateDetailedFilteredStats();
                } else {
                    updateSimpleFilteredStats();
                }
            }
            
            function getCardsForPath(path) {
                // Filtra decks APENAS do modo ativo para métricas de assunto (global)
                const decks = getDeckList(currentStudyMode);
                const cards = new Set();
                decks.forEach(deck => {
                    // Pega todos os cards de decks que começam com o path
                    if (deck.path.startsWith(path)) {
                         for (let i = 1; i <= deck.count; i++) {
                            const prefix = currentStudyMode === 'treinoLivre' ? 'tl' : 're';
                            cards.add(`${prefix}_${deck.path}-${i}`);
                        }
                    }
                });
                return Array.from(cards);
            }

            function updateSimpleFilteredStats() {
                 const reviews = loadReviews(currentStudyMode); // Usa reviews do MODO ATIVO
                 const allSubjectItems = subjectListContainer.querySelectorAll('.subject-item');
                 allSubjectItems.forEach(item => {
                    const path = item.dataset.path;
                    const allCardsInPath = getCardsForPath(path);
                    const statSpan = item.querySelector('.simple-stats');
                    
                    if (!statSpan || allCardsInPath.length === 0) {
                        if(statSpan) statSpan.style.display = 'none';
                        return;
                    }

                    const reviewedInPath = allCardsInPath.filter(cardId => reviews[cardId] && reviews[cardId].length > 0);
                    const percentage = allCardsInPath.length > 0 ? Math.round((reviewedInPath.length / allCardsInPath.length) * 100) : 0;
                    
                    statSpan.textContent = `${percentage}%`;
                    statSpan.style.display = 'inline';
                });
            }
            
            function updateDetailedFilteredStats() {
                const reviews = loadReviews(currentStudyMode); // Usa reviews do MODO ATIVO
                const allSubjectItems = subjectListContainer.querySelectorAll('.subject-item');
                allSubjectItems.forEach(item => {
                    const path = item.dataset.path;
                    const allCardsInPath = getCardsForPath(path);
                    const statsDiv = item.querySelector('.detailed-stats');

                    if (!statsDiv || allCardsInPath.length === 0) return;

                    const stats = { total: allCardsInPath.length, 1: 0, 2: 0, 3: 0, 4: 0 };
                    
                    // Contabiliza apenas o último rating de cada card
                    allCardsInPath.forEach(cardId => {
                        const cardReviews = reviews[cardId];
                        if (cardReviews && cardReviews.length > 0) {
                            const lastReview = cardReviews[cardReviews.length - 1];
                            stats[lastReview.rating]++;
                        }
                    });

                    statsDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span>Total: ${stats.total}</span>
                            <div class="flex gap-4">
                                <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-green-500"></div>Fácil: ${stats[4]}</span>
                                <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-yellow-500"></div>Moderado: ${stats[3]}</span>
                                <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-orange-500"></div>Difícil: ${stats[2]}</span>
                                <span class="flex items-center gap-1.5"><div class="w-2 h-2 rounded-full bg-purple-500"></div>Errei: ${stats[1]}</span>
                            </div>
                        </div>
                    `;
                });
            }

            function updateAllDashboardStats() {
                // Esta função agora deve usar reviews APENAS do currentStudyMode
                const reviews = loadReviews(currentStudyMode);
                const allReviewValues = Object.values(reviews).flat(); // Todas as revisões do modo ativo
                
                // Métrica: Total e Média
                document.getElementById('totalReviewed').textContent = allReviewValues.length;

                const dailyCounts = {};
                allReviewValues.forEach(review => {
                    dailyCounts[review.date] = (dailyCounts[review.date] || 0) + 1;
                });
                const daysStudied = Object.keys(dailyCounts).length;
                const avg = daysStudied > 0 ? (allReviewValues.length / daysStudied).toFixed(1) : 0;
                document.getElementById('avgCardsDay').textContent = avg;

                // Métrica: Cards Dominados
                const decksInMode = getDeckList(currentStudyMode);
                const totalCardsInMode = decksInMode.reduce((sum, deck) => sum + deck.count, 0);
                let dominatedCount = 0;
                Object.keys(reviews).forEach(cardId => {
                    const reviewArray = reviews[cardId];
                    // Verifica se o ID pertence ao modo ativo e foi dominado
                    if (reviewArray && reviewArray.length > 0 && reviewArray[reviewArray.length - 1].rating === 4) {
                        dominatedCount++;
                    }
                });

                const dominatedPct = totalCardsInMode > 0 ? (dominatedCount / totalCardsInMode * 100) : 0;
                const dominatedPctCapped = Math.min(100, dominatedPct).toFixed(0);
                document.getElementById('dominatedCardsText').textContent = `${dominatedCount}/${totalCardsInMode} cards do total`;
                
                const bar = document.getElementById('dominatedCardsBar');
                const percentEl = document.getElementById('dominatedCardsPercent');
                
                bar.style.width = `${dominatedPctCapped}%`;
                percentEl.textContent = `${dominatedPctCapped}%`;
                let leftPosition = Math.max(0, parseFloat(dominatedPctCapped) - 2);
                percentEl.style.left = `${leftPosition}%`;
                percentEl.style.transform = `translateX(-${leftPosition > 80 ? 100 : 50}%)`;
                
                
                // Métrica: Gráfico de Pizza "Cards Estudados"
                const stats = { 1: 0, 2: 0, 3: 0, 4: 0 };
                Object.keys(reviews).forEach(cardId => {
                     const reviewArray = reviews[cardId];
                     if (reviewArray.length > 0) {
                         stats[reviewArray[reviewArray.length - 1].rating]++;
                     }
                });
                
                const totalLastReview = Object.keys(reviews).length; // Contagem de cards com pelo menos 1 review NO MODO ATIVO
                document.getElementById('studiedCardsTotal').textContent = totalLastReview;
                
                document.getElementById('stats-errei-qnt').textContent = stats[1];
                document.getElementById('stats-dificil-qnt').textContent = stats[2];
                document.getElementById('stats-medio-qnt').textContent = stats[3];
                document.getElementById('stats-facil-qnt').textContent = stats[4];
                document.getElementById('stats-total-qnt').textContent = totalLastReview;

                document.getElementById('stats-errei-pct').textContent = totalLastReview > 0 ? `${((stats[1]/totalLastReview)*100).toFixed(0)}%` : '0%';
                document.getElementById('stats-dificil-pct').textContent = totalLastReview > 0 ? `${((stats[2]/totalLastReview)*100).toFixed(0)}%` : '0%';
                document.getElementById('stats-medio-pct').textContent = totalLastReview > 0 ? `${((stats[3]/totalLastReview)*100).toFixed(0)}%` : '0%';
                document.getElementById('stats-facil-pct').textContent = totalLastReview > 0 ? `${((stats[4]/totalLastReview)*100).toFixed(0)}%` : '0%';

                if(window.studiedCardsChart) {
                    window.studiedCardsChart.data.datasets[0].data = [stats[4], stats[3], stats[2], stats[1]];
                    window.studiedCardsChart.update();
                }

                // Métrica: Gráfico de Evolução
                if(window.evolutionChart) {
                    const months = [];
                    const datasets = { 1: [], 2: [], 3: [], 4: [] };
                    const now = new Date();

                    for (let i = 5; i >= 0; i--) { // Últimos 6 meses
                        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                        const monthKey = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                        months.push({ key: monthKey, label: d.toLocaleString('pt-BR', { month: 'short', year: '2-digit' }) });
                        datasets[1].push(0); datasets[2].push(0); datasets[3].push(0); datasets[4].push(0);
                    }
                    
                    allReviewValues.forEach(review => {
                        const reviewMonthKey = review.date.substring(0, 7);
                        const monthIndex = months.findIndex(m => m.key === reviewMonthKey);
                        if(monthIndex > -1) {
                            datasets[review.rating][monthIndex]++;
                        }
                    });

                    window.evolutionChart.data.labels = months.map(m => m.label);
                    window.evolutionChart.data.datasets[0].data = datasets[4]; // Fácil
                    window.evolutionChart.data.datasets[1].data = datasets[3]; // Moderado
                    window.evolutionChart.data.datasets[2].data = datasets[2]; // Difícil
                    window.evolutionChart.data.datasets[3].data = datasets[1]; // Errei
                    window.evolutionChart.update();
                }
                
                // Métrica: Calendário
                // O calendário usa reviews do MODO ATIVO
                generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
            }


            // --- Gráficos (Dashboard) e Calendário ---
            let currentCalendarDate = new Date();

            const studiedCtx = document.getElementById('studiedCardsChart').getContext('2d');
            window.studiedCardsChart = new Chart(studiedCtx, { type: 'doughnut', data: { datasets: [{ data: [0,0,0,0], backgroundColor: ['#22c55e', '#eab308', '#f97316', '#a855f7'], borderColor: '#1E1E1E', borderWidth: 6, cutout: '80%' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } } } });
            
            const todayProgressCtx = document.getElementById('todayProgressChart').getContext('2d');
            window.todayProgressChart = new Chart(todayProgressCtx, { 
                type: 'doughnut', 
                data: { 
                    datasets: [{ 
                        data: [0, 100], 
                        backgroundColor: ['#D98E73', '#3E454D'], 
                        borderColor: '#121212',
                        borderWidth: 4, 
                        cutout: '75%',
                        circumference: 270,
                        rotation: 225,
                    }] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { display: false }, 
                        tooltip: { enabled: false } 
                    } 
                } 
            });

            const evolutionCtx = document.getElementById('evolutionChart').getContext('2d');
            window.evolutionChart = new Chart(evolutionCtx, { type: 'line', 
                data: { 
                    labels: [], 
                    datasets: [
                        { label: 'Fácil', data: [], borderColor: '#22C55E', backgroundColor: 'rgba(34, 197, 94, 0.2)', fill: true, tension: 0.4 }, 
                        { label: 'Moderado', data: [], borderColor: '#F59E0B', backgroundColor: 'rgba(245, 158, 11, 0.2)', fill: true, tension: 0.4 },
                        { label: 'Difícil', data: [], borderColor: '#f97316', backgroundColor: 'rgba(249, 115, 22, 0.2)', fill: true, tension: 0.4 },
                        { label: 'Errei', data: [], borderColor: '#a855f7', backgroundColor: 'rgba(168, 85, 247, 0.2)', fill: true, tension: 0.4 }
                    ] 
                }, 
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#9CA3AF' } }, x: { grid: { display: false }, ticks: { color: '#9CA3AF' } } }, plugins: { legend: { display: false } } } });
            
            function populateCalendarSelect() {
                const now = new Date();
                currentCalendarDate = new Date(now.getFullYear(), now.getMonth(), 1);
                calendarMonthYearSelect.innerHTML = '';
                // Popula com 6 meses passados, atual e 6 meses futuros
                for (let i = 6; i >= -6; i--) { 
                    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                    const option = document.createElement('option');
                    option.value = `${d.getFullYear()}-${d.getMonth()}`;
                    option.textContent = d.toLocaleString('pt-BR', { month: 'long', year: 'numeric' });
                    if (i === 0) {
                        option.selected = true;
                    }
                    calendarMonthYearSelect.appendChild(option);
                }
            }
            
            function generateCalendar(year, month) {
                // O calendário agora usa reviews APENAS do modo ativo
                const reviews = loadReviews(currentStudyMode);
                const dailyCounts = {};
                Object.values(reviews).flat().forEach(review => {
                    dailyCounts[review.date] = (dailyCounts[review.date] || 0) + 1;
                });
                
                calendarContainer.innerHTML = ''; 
                const monthName = new Date(year, month).toLocaleString('pt-BR', { month: 'long' });
                document.getElementById('calendar-title').textContent = `${monthName.charAt(0).toUpperCase() + monthName.slice(1)} ${year}`;

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                const weekDays = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
                calendarContainer.innerHTML += `<div class="font-semibold text-gray-500 self-end pb-2">Semana</div>`;
                weekDays.forEach(day => {
                    calendarContainer.innerHTML += `<div class="font-semibold text-gray-500">${day}</div>`;
                });
                
                let dayGrid = [];
                // Preenche espaços em branco do início do mês
                for(let i=0; i<firstDayOfMonth; i++) { dayGrid.push(''); }
                // Preenche os dias do mês
                for(let i=1; i<=daysInMonth; i++) { dayGrid.push(i); }

                let weekNumber = 1;
                let currentDayIndex = 0;
                while (currentDayIndex < dayGrid.length) {
                     calendarContainer.innerHTML += `<div class="text-gray-500 font-semibold self-center">Semana ${weekNumber}</div>`;
                     for(let i = 0; i < 7; i++) {
                        const day = dayGrid[currentDayIndex];
                        if (day) {
                            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                            const studiedCount = dailyCounts[dateStr];
                            let dayClasses = 'py-3 rounded-lg flex items-center justify-center cursor-pointer';
                            let tooltipHtml = '';

                            if(studiedCount > 0) {
                                dayClasses += ' calendar-day-studied text-white has-tooltip';
                                tooltipHtml = `<div class="tooltip">${studiedCount} cards</div>`;
                            } else {
                                dayClasses += ' calendar-day hover:bg-gray-600';
                            }

                            if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                                dayClasses += ' calendar-day-today';
                            }

                            calendarContainer.innerHTML += `<div class="${dayClasses}">${day}${tooltipHtml}</div>`;
                        } else {
                             calendarContainer.innerHTML += `<div></div>`;
                        }
                        currentDayIndex++;
                     }
                     weekNumber++;
                }
            }
            
            calendarMonthYearSelect.addEventListener('change', () => {
                const [year, month] = calendarMonthYearSelect.value.split('-').map(Number);
                currentCalendarDate = new Date(year, month);
                generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
            });
            
            document.getElementById('calendar-prev').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                // Atualiza o select para refletir o mês
                calendarMonthYearSelect.value = `${currentCalendarDate.getFullYear()}-${currentCalendarDate.getMonth()}`;
                generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
            });

            document.getElementById('calendar-next').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                // Atualiza o select para refletir o mês
                calendarMonthYearSelect.value = `${currentCalendarDate.getFullYear()}-${currentCalendarDate.getMonth()}`;
                generateCalendar(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth());
            });
            
            // --- Lógica de Filtros Avançados ---
            function getFilteredFlashcards() {
                // A lista de decks é determinada pelo modo atual.
                const reviews = loadReviews(currentStudyMode);
                const decks = getDeckList(currentStudyMode);
                
                if (currentStudyMode === 'treinoLivre') {
                    const selectedPaths = getSelectedFilterPaths();
                    let filteredCards = generateFlashcardList(selectedPaths);

                    // Filtro de Exclusão: Vistos (cards que têm pelo menos 1 review)
                    if (excludeVistos.checked) {
                        filteredCards = filteredCards.filter(card => !reviews[card.id] || reviews[card.id].length === 0);
                    }
                    // Filtro de Exclusão: Dominados (cards classificados como 4 - Fácil na última review)
                    if (excludeDominados.checked) {
                         filteredCards = filteredCards.filter(card => {
                            const cardReviews = reviews[card.id];
                            return !cardReviews || cardReviews.length === 0 || cardReviews[cardReviews.length - 1].rating !== 4;
                        });
                    }

                    // Filtro de Dificuldade (baseado no último rating)
                    if (activeDifficultyFilter !== 'all') {
                        filteredCards = filteredCards.filter(card => {
                            const cardReviews = reviews[card.id];
                            if (!cardReviews || cardReviews.length === 0) return false; 
                            const lastReview = cardReviews[cardReviews.length - 1];
                            return lastReview.rating == activeDifficultyFilter;
                        });
                    }
                    return filteredCards;
                } else { // 'revisaoEspacada'
                    const selectedSubjects = [];
                    revisaoSubjectListContainer.querySelectorAll('.revisao-filter-cb:checked').forEach(cb => {
                        selectedSubjects.push(cb.nextElementSibling.textContent);
                    });
                    
                    // Retorna a lista de cards agendados para revisão (simulados)
                    return generateRevisaoFlashcardList(selectedSubjects);
                }
            }

            // --- Listeners dos Filtros ---
            selectAllBtn.addEventListener('click', () => {
                subjectListContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
                // Garante que os pais atualizem o estado indeterminate
                subjectListContainer.querySelectorAll('.subject-item').forEach(item => updateParentCheckboxes(item)); 
                updateFlashcardCount();
            });

            unselectAllBtn.addEventListener('click', () => {
                subjectListContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                    cb.indeterminate = false;
                });
                updateFlashcardCount();
            });

            statsToggle.addEventListener('change', updateStatsVisibility);
            
            difficultyFilters.addEventListener('click', (e) => {
                const button = e.target.closest('.difficulty-btn');
                if(!button) return;

                difficultyFilters.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                activeDifficultyFilter = button.dataset.difficulty;
                updateFlashcardCount();
            });
            
            [excludeVistos, excludeDominados].forEach(checkbox => {
                checkbox.addEventListener('change', updateFlashcardCount);
            });

            resetFiltersBtn.addEventListener('click', () => {
                unselectAllBtn.click();
                excludeVistos.checked = false;
                excludeDominados.checked = false;
                difficultyFilters.querySelector('.active').classList.remove('active');
                difficultyFilters.querySelector('[data-difficulty="all"]').classList.add('active');
                activeDifficultyFilter = 'all';
                updateFlashcardCount();
            });
            
            // --- Lógica para Filtro de Revisão ---
            function populateRevisaoFilters() {
                revisaoSubjectListContainer.innerHTML = '';
                // Simula contagem de cards para hoje por assunto
                const allReviewCards = generateRevisaoFlashcardList([]);
                const cardCountMap = {};
                allReviewCards.forEach(card => {
                    // Mapeia o deck de revisão para o nome do assunto na lista de filtros
                    const subjectName = subjectsDataRevisao.find(sub => card.path.includes(sub)) || 'Outros';
                    cardCountMap[subjectName] = (cardCountMap[subjectName] || 0) + 1;
                });

                subjectsDataRevisao.forEach(subjectName => {
                    const count = cardCountMap[subjectName] || 0;
                    const percent = count > 0 ? (Math.random() * 50 + 50).toFixed(0) : 0; // Simula a porcentagem de completude
                    
                    const itemHtml = `
                        <div class="flex items-center justify-between p-3 bg-[#2D2D2D] rounded-lg">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" class="w-4 h-4 bg-gray-700 border-gray-600 rounded revisao-filter-cb">
                                <span>${subjectName}</span>
                            </label>
                            <span class="text-sm text-gray-400">${count} cards para hoje</span>
                        </div>
                    `;
                    revisaoSubjectListContainer.innerHTML += itemHtml;
                });
                // Adiciona listeners aos novos checkboxes
                revisaoSubjectListContainer.querySelectorAll('.revisao-filter-cb').forEach(cb => cb.addEventListener('change', updateFlashcardCount));
            }
            
            resetRevisaoFiltersBtn.addEventListener('click', () => {
                revisaoSubjectListContainer.querySelectorAll('.revisao-filter-cb').forEach(cb => cb.checked = false);
                updateFlashcardCount();
            });
            
            function handleFilterSearch() {
                const searchTerm = filterSearchInput.value.toLowerCase();
                const allItems = Array.from(subjectListContainer.querySelectorAll('.subject-item'));
                const visibility = new Map();

                // 1. Marca itens que contêm o termo de busca
                allItems.forEach(item => {
                    const itemName = item.querySelector('p').textContent.toLowerCase();
                    if (itemName.includes(searchTerm)) {
                        visibility.set(item, true);
                    }
                });
                
                // 2. Marca os pais dos itens visíveis como visíveis (para manter a hierarquia)
                for (let i = allItems.length - 1; i >= 0; i--) {
                    const item = allItems[i];
                    if (visibility.get(item)) {
                        let parent = item.parentElement.closest('.subject-item');
                        while (parent) {
                            if (!visibility.get(parent)) {
                                 visibility.set(parent, true);
                                 // Expande o container do pai
                                 const childrenContainer = parent.querySelector('.subject-children');
                                 if (childrenContainer) childrenContainer.classList.remove('hidden');
                                 const icon = parent.querySelector('[data-lucide="chevron-down"]');
                                 if (icon) icon.classList.add('rotate-180');
                            }
                            parent = parent.parentElement.closest('.subject-item');
                        }
                    }
                }
                
                // 3. Aplica a visibilidade
                allItems.forEach(item => {
                    item.style.display = visibility.get(item) ? 'block' : 'none';
                });
            }

            function handleRevisaoSearch() {
                const searchTerm = revisaoFilterSearchInput.value.toLowerCase();
                const items = revisaoSubjectListContainer.children;
                for (const item of items) {
                    const text = item.querySelector('span').textContent.toLowerCase();
                    item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
                }
            }

            filterSearchInput.addEventListener('input', handleFilterSearch);
            revisaoFilterSearchInput.addEventListener('input', handleRevisaoSearch);

            // --- LÓGICA DE BUSCA AVANÇADA (ATUALIZADA) ---
            const searchResultsContainer = document.getElementById('searchResults');
            const searchableSections = [
                { name: 'Treino Livre', id: 'cardsRevisadosTreino' },
                { name: 'Métricas dos Flashcards', id: 'metricasSection' },
                { name: 'Cards Estudados', id: 'studiedCardsSection' },
                { name: 'Evolução', id: 'evolutionSection' },
                { name: 'Calendário de Estudos', id: 'calendarSection' }
            ];
            let allSubjectsFlat = [];

            function flattenSubjects(subjects, path = '') {
                let result = [];
                subjects.forEach(item => {
                    const name = typeof item === 'string' ? item : item.name;
                    const currentPath = path ? `${path} > ${name}` : name;
                    
                    if (typeof item === 'string' || !item.children || item.children.length === 0) {
                        result.push({ name: name, path: currentPath });
                    }
                    
                    if (item.children && item.children.length > 0) {
                        result = result.concat(flattenSubjects(item.children, currentPath));
                    }
                });
                return result;
            }
            allSubjectsFlat = flattenSubjects(subjectsData);

            function executeSearchAction(targetElement) {
                if (!targetElement) return;

                const action = targetElement.dataset.action;
                if (action === 'scroll') {
                    const targetId = targetElement.dataset.targetId;
                    document.getElementById(targetId)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else if (action === 'filter') {
                    const filterValue = targetElement.dataset.filterValue;
                    openModal(filtersModal);
                    // Garante que o modo seja Treino Livre antes de filtrar
                    switchStudyMode('treinoLivre'); 
                    filterSearchInput.value = filterValue;
                    handleFilterSearch();
                }
                closeSearchBtn.click();
            }

            function handleSearchResultClick(e) {
                e.preventDefault();
                executeSearchAction(e.currentTarget);
            }

            searchInput.addEventListener('input', () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                
                if (searchTerm.length < 2) {
                    searchResultsContainer.innerHTML = '';
                    searchResultsContainer.classList.add('hidden');
                    return;
                }

                const sectionResults = searchableSections.filter(s => s.name.toLowerCase().includes(searchTerm));
                const subjectResults = allSubjectsFlat.filter(s => s.name.toLowerCase().includes(searchTerm)).slice(0, 5);

                searchResultsContainer.innerHTML = '';

                if (sectionResults.length === 0 && subjectResults.length === 0) {
                    searchResultsContainer.innerHTML = '<p class="px-4 py-3 text-sm text-gray-500">Nenhum resultado encontrado.</p>';
                } else {
                    if (sectionResults.length > 0) {
                        searchResultsContainer.innerHTML += '<h3 class="px-4 pt-3 pb-1 text-xs text-gray-400 font-semibold">SEÇÕES DA PÁGINA</h3>';
                        sectionResults.forEach(section => {
                            const item = document.createElement('a');
                            item.href = `#${section.id}`;
                            item.className = 'search-result-item block px-4 py-2 text-sm hover:bg-white/10 rounded-md mx-2';
                            item.textContent = section.name;
                            item.dataset.action = 'scroll';
                            item.dataset.targetId = section.id;
                            item.addEventListener('click', handleSearchResultClick);
                            searchResultsContainer.appendChild(item);
                        });
                    }

                    if (subjectResults.length > 0) {
                        searchResultsContainer.innerHTML += '<h3 class="px-4 pt-3 pb-1 text-xs text-gray-400 font-semibold">FILTROS DE ASSUNTO</h3>';
                        subjectResults.forEach(subject => {
                            const item = document.createElement('a');
                            item.href = '#';
                            item.className = 'search-result-item block px-4 py-2 text-sm hover:bg-white/10 rounded-md mx-2';
                            item.innerHTML = `<span class="font-semibold">${subject.name}</span><span class="text-xs text-gray-500 block truncate">${subject.path}</span>`;
                            item.dataset.action = 'filter';
                            item.dataset.filterValue = subject.name;
                            item.addEventListener('click', handleSearchResultClick);
                            searchResultsContainer.appendChild(item);
                        });
                    }
                }
                searchResultsContainer.classList.remove('hidden');
            });
            
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const firstResult = searchResultsContainer.querySelector('.search-result-item');
                    if (firstResult) {
                        executeSearchAction(firstResult);
                    }
                }
            });

            // O listener para fechar resultados de busca no clique fora já está no final do script.

            // --- INICIALIZAÇÃO ---
            // Simula algumas reviews iniciais para preencher os gráficos
            function simulateInitialReviews() {
                // Limpa o localStorage antes de começar para garantir um estado limpo
                localStorage.removeItem(TREINO_LIVRE_REVIEWS_KEY);
                localStorage.removeItem(REVISAO_ESPACADA_REVIEWS_KEY);
                localStorage.removeItem(STUDY_TIME_KEY_TREINO);
                localStorage.removeItem(STUDY_TIME_KEY_REVISAO);

                const reviewsTreino = {};
                const reviewsRevisao = {};
                const dailyTimesTreino = {};
                const dailyTimesRevisao = {};
                const today = new Date();
                
                // 1. Simula reviews para Treino Livre
                treinoLivreDecks.forEach(deck => {
                    for(let i=1; i<=deck.count; i++) {
                        const cardId = `tl_${deck.path}-${i}`;
                        const rating = Math.floor(Math.random() * 4) + 1; // 1 a 4
                        const daysAgo = Math.floor(Math.random() * 60); 
                        const reviewDate = new Date(today);
                        reviewDate.setDate(today.getDate() - daysAgo);
                        const reviewDateStr = reviewDate.toISOString().split('T')[0];

                        reviewsTreino[cardId] = [{ 
                            rating: rating, 
                            date: reviewDateStr 
                        }];
                    }
                });
                
                // 2. Simula reviews para Revisão Espaçada (Apenas nos dias anteriores, NUNCA HOJE para começar zerado)
                 revisaoEspacadaDecks.forEach(deck => {
                    for(let i=1; i<=deck.count; i++) {
                        const cardId = `re_${deck.path}-${i}`;
                         // Simula revisões ocorridas 10 dias atrás para preencher o calendário
                         const pastDate = new Date(today);
                         pastDate.setDate(today.getDate() - 10);
                         const pastDateStr = pastDate.toISOString().split('T')[0];

                         if (i % 10 === 0) {
                            reviewsRevisao[cardId] = [{ 
                                rating: Math.floor(Math.random() * 4) + 1, 
                                date: pastDateStr
                            }];
                        }
                    }
                });

                localStorage.setItem(TREINO_LIVRE_REVIEWS_KEY, JSON.stringify(reviewsTreino));
                localStorage.setItem(REVISAO_ESPACADA_REVIEWS_KEY, JSON.stringify(reviewsRevisao)); // Esta chave deve estar limpa para HOJE

                // 3. Simula tempo de estudo e sequência separada
                for(let i = 0; i < 7; i++) {
                    const pastDate = new Date(today);
                    pastDate.setDate(today.getDate() - i);
                    const pastDateStr = pastDate.toISOString().split('T')[0];
                    
                    // Treino Livre: 7 dias seguidos (20 min)
                    dailyTimesTreino[pastDateStr] = 20 * 60 * 1000; 
                    
                    // Revisão Espaçada: 4 dias seguidos ANTERIORES. NADA HOJE.
                    if (i > 0 && i < 5) {
                       dailyTimesRevisao[pastDateStr] = 10 * 60 * 1000;
                    }
                }
                localStorage.setItem(STUDY_TIME_KEY_TREINO, JSON.stringify(dailyTimesTreino));
                localStorage.setItem(STUDY_TIME_KEY_REVISAO, JSON.stringify(dailyTimesRevisao));
            }
            simulateInitialReviews();

            switchStudyMode('treinoLivre');
            populateCalendarSelect();
            populateRevisaoFilters();
            // As próximas atualizações são chamadas dentro de switchStudyMode/updateAllDashboardStats
            lucide.createIcons();
        });
    </script>
</body>
</html>

